<!DOCTYPE html>
<html lang="bn" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taka Money - আপনার ডিজিটাল আয়ের বিশ্বস্ত সঙ্গী</title>
    <meta name="description" content="Taka Money-এর মাধ্যমে নিরাপদে ইনভেস্ট করুন এবং প্রতিদিন আকর্ষণীয় রিটার্ন পান। আধুনিক, নিরাপদ এবং ব্যবহারকারী-বান্ধব প্ল্যাটফর্ম।">
    <meta name="keywords" content="taka money, online income, investment, bKash deposit, daily income, Bangladesh, earn money online, referral income, admin panel">
    
    <!-- External Libraries (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* 
        =====================================================================
        MASTER STYLESHEET FOR Taka Money APPLICATION (MODIFIED WITH ADMIN PANEL)
        This block contains all combined CSS with new VFX and UI changes.
        =====================================================================
        */
        
        /* Base Variables and Styles */
        :root {
            --primary-color: #10b981; /* Emerald 500 */
            --primary-color-dark: #059669; /* Emerald 600 */
            --background-dark: #020617;
            --slate-900: #0f172a;
            --slate-800: #1e293b;
            --slate-700: #334155;
            --slate-600: #475569;
            --slate-400: #94a3b8;
            --slate-300: #cbd5e1;
            --white-color: #ffffff;
            --red-color: #ef4444;
            --green-color: #10b981;
        }
        
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--background-dark);
            color: var(--slate-300);
            position: relative;
            overflow-x: hidden;
        }

        /* NEW: Animated Gradient Background with Emerald Green */
        .animated-gradient-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #020617, #0f172a, #1e293b, #047857, #10b981, #059669);
            background-size: 400% 400%;
            animation: gradientAnimation 25s ease infinite;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* NEW: VFX for Logo Text */
        @keyframes text-glow {
            0% { text-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color); }
            50% { text-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color); }
            100% { text-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color); }
        }
        .logo-vfx {
            animation: text-glow 3s ease-in-out infinite;
        }

        /* Glassmorphism UI Card Style */
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-radius: 1rem; border: 1px solid rgba(100, 116, 139, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }
        .glass-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.35);
            border-color: rgba(16, 185, 129, 0.5);
        }

        /* All Button Styles */
        .cta-button, .cta-button-animated, .cta-button-secondary {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.8rem 1.8rem; font-weight: 700; border-radius: 0.5rem;
            transition: all 0.3s ease; cursor: pointer;
        }
        .cta-button-animated {
            position: relative; color: var(--white-color); background-color: var(--primary-color-dark);
            border: none; overflow: hidden; z-index: 1;
        }
        .cta-button-animated::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: var(--primary-color); z-index: -1;
            transform: scaleX(0); transform-origin: left; transition: transform 0.4s ease-in-out;
        }
        .cta-button-animated:hover::before { transform: scaleX(1); }
        .cta-button-secondary {
            color: var(--white-color); background-color: transparent;
            border: 2px solid var(--primary-color-dark);
        }
        .cta-button-secondary:hover { background-color: var(--primary-color-dark); }

        /* NEW: VFX for Deposit Submit Button */
        #depositSubmitBtn {
            box-shadow: 0 0 10px 0 rgba(16, 185, 129, 0);
            transition: all 0.3s ease;
        }
        #depositSubmitBtn:not(:disabled):hover {
            box-shadow: 0 0 25px 5px rgba(16, 185, 129, 0.5);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--slate-900); }
        ::-webkit-scrollbar-thumb { background: var(--primary-color-dark); border-radius: 10px; border: 2px solid var(--slate-900); }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* Generic Form Input Styles */
        .form-input {
            width: 100%; background-color: rgba(30, 41, 59, 0.8);
            border: 1px solid var(--slate-700); border-radius: 0.5rem;
            padding: 0.85rem 1rem; color: var(--white-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-input:focus {
            outline: none; border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.4);
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(2, 6, 23, 0.7); backdrop-filter: blur(8px);
            display: flex; justify-content: center; align-items: center; z-index: 1000;
            opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            position: relative; background: var(--slate-900); padding: 2.5rem; border-radius: 1rem;
            border: 1px solid var(--slate-700); width: 90%; max-width: 500px;
            transform: scale(0.9) translateY(20px); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        .modal-overlay.active .modal-content { transform: scale(1) translateY(0); }
        .modal-close-btn {
            position: absolute; top: 1rem; right: 1rem; background: none; border: none;
            color: var(--slate-400); font-size: 1.8rem; line-height: 1; cursor: pointer;
            transition: color 0.3s, transform 0.3s;
        }
        .modal-close-btn:hover { color: var(--white-color); transform: rotate(90deg); }
        
        /* Floating Notification Styles */
        #notification-container {
            position: fixed; top: 6rem; right: 1.5rem; z-index: 2000;
            display: flex; flex-direction: column; gap: 0.75rem;
        }
        .notification {
            min-width: 320px; padding: 1rem 1.5rem; border-radius: 0.5rem; color: var(--white-color);
            opacity: 0; transform: translateX(120%); transition: all 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4); border-left: 5px solid transparent;
            display: flex; align-items: center; gap: 1rem;
        }
        .notification.show { opacity: 1; transform: translateX(0); }
        .notification.success { background: linear-gradient(to right, #10b981, #059669); border-left-color: #34d399; }
        .notification.error { background: linear-gradient(to right, #ef4444, #dc2626); border-left-color: #f87171; }
        .notification.info { background: linear-gradient(to right, #3b82f6, #2563eb); border-left-color: #60a5fa; }
        
        /* Page/View Management */
        .page-view {
            display: none;
            animation: pageFadeIn 0.6s ease-in-out;
        }
        .page-view.active { display: block; }
        @keyframes pageFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard-specific styles */
        .stat-card { position: relative; padding: 1.5rem; border-radius: 1rem; background: linear-gradient(145deg, var(--slate-800), var(--slate-900)); border: 1px solid var(--slate-700); transition: transform 0.3s, box-shadow 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .stat-card .icon-bg { position: absolute; top: 1.5rem; right: 1.5rem; font-size: 3rem; color: rgba(100, 116, 139, 0.1); transform: rotate(-15deg); }
        
        /* MODIFIED: Unified Dashboard/Admin Tabs */
        .dashboard-tab-button, .admin-tab-button {
            padding: 0.75rem 1.5rem; font-weight: 600; color: var(--slate-400); 
            border-bottom: 3px solid transparent; transition: color 0.3s, border-color 0.3s;
            white-space: nowrap;
        }
        .dashboard-tab-button.active, .admin-tab-button.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .dashboard-tab-content, .admin-tab-content { display: none; animation: fadeIn 0.5s ease; }
        .dashboard-tab-content.active, .admin-tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .dashboard-table { width: 100%; border-collapse: collapse; margin-top: 1rem; font-size: 0.9rem; }
        .dashboard-table thead th { padding: 1rem; text-align: left; font-size: 0.8rem; color: var(--slate-400); text-transform: uppercase; border-bottom: 2px solid var(--slate-700); }
        .dashboard-table tbody td { padding: 1rem; border-bottom: 1px solid var(--slate-800); }
        .dashboard-table tbody tr:last-child td { border-bottom: none; }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 600; }
        .status-success { background-color: rgba(16, 185, 129, 0.1); color: #34d399; }
        .status-pending { background-color: rgba(245, 158, 11, 0.1); color: #fcd34d; }
        .status-rejected { background-color: rgba(239, 68, 68, 0.1); color: #f87171; }

        /* NEW: Admin action button */
        .admin-action-btn {
            padding: 0.3rem 0.8rem; font-size: 0.8rem; font-weight: 600; border-radius: 0.375rem; transition: background-color 0.2s;
        }
        
        /* Levels Page Styles */
        .level-card.active { border-color: var(--primary-color); box-shadow: 0 0 40px rgba(16, 185, 129, 0.5); transform: scale(1.05); }
        .active-badge { position: absolute; top: 1rem; right: 1rem; background-color: var(--primary-color); color: var(--slate-900); padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 700; animation: pulse 2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            50% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        }

        /* Income Today Page Styles */
        #claim-button { padding: 1.5rem 3rem; font-size: 1.5rem; font-weight: 700; border-radius: 9999px; color: #fff; background: linear-gradient(45deg, var(--primary-color-dark), var(--primary-color)); border: none; box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        #claim-button:hover:not(:disabled) { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 40px rgba(16, 185, 129, 0.5); }
        #claim-button:disabled { background: #334155; cursor: not-allowed; box-shadow: none; transform: none; opacity: 0.7; }
        #claim-button.claimed { background: linear-gradient(45deg, #4ade80, #22c55e); box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4); }
        .text-shadow-emerald { text-shadow: 0 0 15px var(--primary-color); }

        /* Coin Animation */
        .coin-animation-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9999; overflow: hidden; }
        .coin { position: absolute; width: 30px; height: 30px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2310b981"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.5 13.5h3v-1h-3v1zm0-3h3v-1h-3v1zm0-3h3v-1h-3v1z"/></svg>'); background-size: contain; animation: fall 3s linear; opacity: 0; }
        @keyframes fall { 0% { transform: translateY(-100px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
    </style>
</head>
<body class="bg-slate-900 text-slate-300">

    <!-- Global Elements -->
    <div class="animated-gradient-background"></div>
    <div id="notification-container"></div>
    <div class="coin-animation-container" id="coin-container"></div>

    <!-- Header -->
    <header class="sticky top-0 left-0 w-full z-50 bg-slate-900/60 backdrop-blur-xl border-b border-slate-700/50 shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
             <a href="#index" class="nav-link flex items-center space-x-3">
                <svg class="w-8 h-8 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1m0-1V4m0 2.01M12 18v-2m0-2v-2m0-2v-2m0-2V8m0 0h.01M12 6h.01M12 4h.01M12 18h.01M12 20h.01M4 12h2m2 0h2m2 0h2m2 0h2m-2-2h2m-4 4h2m-6-2h2m-2-2h2"></path></svg>
                <span class="text-2xl font-bold text-white tracking-wider">Taka<span class="text-emerald-400 logo-vfx">Money</span></span>
            </a>
            <!-- MODIFIED: Simplified Navigation -->
            <nav id="main-nav" class="hidden md:flex items-center space-x-6 text-base">
                <a href="#dashboard" class="nav-link hover:text-emerald-400 transition-colors">ড্যাশবোর্ড</a>
                <!-- Other links removed for unified dashboard -->
            </nav>
            <div id="auth-container-desktop"></div>
             <button id="mobile-menu-button" class="md:hidden text-white p-2">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
         <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-800/95">
            <a href="#dashboard" class="nav-link block py-3 px-6 hover:bg-slate-700 transition-colors">ড্যাশবোর্ড</a>
            <div id="auth-container-mobile" class="p-4 border-t border-slate-700"></div>
        </div>
    </header>

    <!-- App Content: This div will hold all page views -->
    <div id="app-content">

        <!-- ===================================================================== -->
        <!-- VIEW 1: INDEX / LANDING PAGE                                          -->
        <!-- ===================================================================== -->
        <div id="page-index" class="page-view active">
            <main>
                <section class="min-h-screen flex items-center pt-28 pb-16">
                    <div class="container mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
                        <div class="hero-content text-center md:text-left">
                            <h1 class="text-4xl md:text-6xl font-extrabold text-white leading-tight mb-5">আপনার ইনকাম শুরু হোক <br class="hidden md:block"> <span class="text-emerald-400">আজ থেকেই!</span></h1>
                            <p class="text-lg md:text-xl text-slate-300 mb-10 max-w-lg mx-auto md:mx-0">Taka Money হলো একটি স্বয়ংক্রিয় ইনকাম প্ল্যাটফর্ম। এখানে আপনার টাকা নিরাপদে বৃদ্ধি পায় এবং আপনি প্রতিদিন নিশ্চিত মুনাফা অর্জন করতে পারেন।</p>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                                <a href="#dashboard" data-tab-link="deposit" class="nav-link cta-button-animated"><span>ডিপোজিট করুন</span><svg class="h-6 w-6 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></a>
                                <a href="#dashboard" class="nav-link cta-button-secondary"><span>ড্যাশবোর্ড দেখুন</span></a>
                            </div>
                        </div>
                        <div class="hero-animation"><lottie-player src="https://assets1.lottiefiles.com/packages/lf20_touohxv0.json" background="transparent" speed="1" style="width: 100%; height: auto; max-width: 500px; margin: 0 auto;" loop autoplay></lottie-player></div>
                    </div>
                </section>
            </main>
        </div>

        <!-- ===================================================================== -->
        <!-- VIEW 2: UNIFIED DASHBOARD PAGE (ALL FEATURES INTEGRATED)              -->
        <!-- ===================================================================== -->
        <div id="page-dashboard" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <h1 class="text-4xl font-bold text-white mb-2">আপনার ড্যাশবোর্ড</h1>
                <p class="text-slate-400 mb-8" id="welcome-message">আপনার আর্থিক অগ্রগতির সংক্ষিপ্ত বিবরণ।</p>

                <!-- Dashboard Tabs Navigation -->
                <div class="border-b border-slate-700 mb-8">
                    <nav class="-mb-px flex space-x-2 sm:space-x-6 overflow-x-auto" id="dashboard-tabs">
                        <button data-tab="overview" class="dashboard-tab-button active">সারসংক্ষেপ</button>
                        <button data-tab="deposit" class="dashboard-tab-button">ডিপোজিট</button>
                        <button data-tab="withdraw" class="dashboard-tab-button">উইথড্র</button>
                        <button data-tab="income_today" class="dashboard-tab-button">ইনকাম সংগ্রহ</button>
                        <button data-tab="levels" class="dashboard-tab-button">আমার লেভেল</button>
                        <button data-tab="referral" class="dashboard-tab-button">রেফারেল</button>
                    </nav>
                </div>

                <!-- Dashboard Tab Content -->
                <div id="dashboard-content">
                    <!-- Tab: Overview -->
                    <div id="tab-overview" class="dashboard-tab-content active">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                            <div class="stat-card"><div class="icon-bg">💰</div><p class="text-slate-400 text-sm font-medium uppercase">বর্তমান ব্যালেন্স</p><p class="text-3xl font-bold text-white mt-1" id="currentBalance">৳ 0.00</p></div>
                            <div class="stat-card"><div class="icon-bg">🚀</div><p class="text-slate-400 text-sm font-medium uppercase">বর্তমান লেভেল</p><p class="text-3xl font-bold text-white mt-1" id="currentLevel">Level 0</p></div>
                            <div class="stat-card"><div class="icon-bg">📈</div><p class="text-slate-400 text-sm font-medium uppercase">মোট আয়</p><p class="text-3xl font-bold text-green-400 mt-1" id="totalIncome">৳ 0.00</p></div>
                            <div class="stat-card"><div class="icon-bg">🏦</div><p class="text-slate-400 text-sm font-medium uppercase">মোট ডিপোজিট</p><p class="text-3xl font-bold text-emerald-400 mt-1" id="totalDeposit">৳ 0.00</p></div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                            <div class="lg:col-span-3 glass-card p-6"><h2 class="text-xl font-bold text-white mb-4">সাপ্তাহিক ইনকাম গ্রাফ</h2><div id="incomeChartContainer"><canvas id="incomeChart"></canvas></div></div>
                            <div class="lg:col-span-2 glass-card p-6">
                                <h2 class="text-xl font-bold text-white mb-4">লেনদেন হিস্টরি</h2>
                                <div class="overflow-y-auto max-h-96"><table class="dashboard-table min-w-full"><thead><tr><th>বিবরণ</th><th>পরিমাণ</th><th>তারিখ</th></tr></thead><tbody id="transactionHistoryTableBody"></tbody></table></div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab: Deposit -->
                    <div id="tab-deposit" class="dashboard-tab-content">
                        <div class="flex justify-center"><div class="w-full max-w-2xl"><div class="glass-card p-8 md:p-12"><div class="text-center mb-8"><h1 class="text-4xl font-bold text-white text-shadow-emerald">নিরাপদ ডিপোজিট</h1><p class="text-slate-400 mt-2">নিচের নির্দেশনা অনুসরণ করে আপনার একাউন্টে টাকা যোগ করুন।</p></div><div class="mb-8"><h3 class="text-xl font-semibold text-white mb-4 flex items-center"><span class="bg-emerald-500 text-slate-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">১</span> টাকা পাঠান</h3><p class="text-slate-400 mb-4">নিচের বিকাশ পার্সোনাল নাম্বারে 'সেন্ড মানি' করুন।</p><div class="bg-slate-800 border-2 dashed border-slate-600 p-4 rounded-lg flex items-center justify-between"><span id="bKashNumberDeposit" class="text-2xl font-bold text-white tracking-widest">01741242983</span><button id="copyButton" class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded-md flex items-center gap-2"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><span>কপি</span></button></div></div><div><h3 class="text-xl font-semibold text-white mb-4 flex items-center"><span class="bg-emerald-500 text-slate-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">২</span> তথ্য জমা দিন</h3><form id="depositForm" class="space-y-6" novalidate><div><label for="depositAmount" class="block mb-2 text-sm font-medium text-slate-300">ডিপোজিটের পরিমাণ (টাকা)</label><input type="number" id="depositAmount" name="depositAmount" class="form-input" placeholder="যেমন: 100" required min="1" max="100"><p class="text-xs text-slate-500 mt-1">দিনে সর্বোচ্চ ১০০ টাকা পর্যন্ত ডিপোজিট করা যাবে।</p></div><div><label for="trxId" class="block mb-2 text-sm font-medium text-slate-300">ট্রানজ্যাকশন আইডি (TrxID)</label><input type="text" id="trxId" name="trxId" class="form-input" placeholder="যেমন: 9A4B8C1D3E" required><p class="text-xs text-slate-500 mt-1">বিকাশ থেকে পাওয়া ট্রানজ্যাকশন আইডি এখানে দিন।</p></div><button type="submit" id="depositSubmitBtn" class="w-full cta-button-animated py-3 text-lg"><span>ডিপোজিট কনফার্ম করুন</span></button></form></div></div></div></div>
                    </div>

                    <!-- Tab: Withdraw -->
                    <div id="tab-withdraw" class="dashboard-tab-content">
                        <div class="flex justify-center"><div class="w-full max-w-lg"><div class="glass-card p-8 md:p-12"><div class="text-center mb-8"><h1 class="text-4xl font-bold text-white text-shadow-emerald">টাকা উত্তোলন</h1><p class="text-slate-400 mt-2">আপনার আয়কৃত টাকা সহজেই উত্তোলন করুন।</p></div><div class="bg-gradient-to-r from-slate-800 to-slate-700 p-4 rounded-lg text-center mb-6 border-l-4 border-emerald-400"><p class="text-sm uppercase text-slate-400">আপনার বর্তমান ব্যালেন্স</p><p id="withdrawPageBalance" class="text-4xl font-bold text-white mt-1">৳ 0.00</p></div><div class="bg-slate-800/50 p-4 rounded-lg text-center mb-8"><p class="text-emerald-300">উইথড্র করার জন্য মিনিমাম <strong class="text-white">৩০০ টাকা</strong> প্রয়োজন।</p></div><form id="withdrawForm" class="space-y-6" novalidate><div><label for="withdrawAmount" class="block mb-2 text-sm font-medium text-slate-300">উইথড্র পরিমাণ</label><input type="number" id="withdrawAmount" name="withdrawAmount" class="form-input" placeholder="টাকার পরিমাণ লিখুন" required></div><div><label for="bKashNumberWithdraw" class="block mb-2 text-sm font-medium text-slate-300">আপনার বিকাশ নাম্বার</label><input type="tel" id="bKashNumberWithdraw" name="bKashNumberWithdraw" class="form-input" placeholder="01..." required pattern="01[3-9]\d{8}"></div><button type="submit" id="withdrawSubmitBtn" class="w-full cta-button py-3 text-lg flex items-center justify-center gap-2 bg-emerald-600 hover:bg-emerald-500"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg><span>রিকোয়েস্ট পাঠান</span></button></form></div></div></div>
                    </div>

                    <!-- Tab: Income Today -->
                    <div id="tab-income_today" class="dashboard-tab-content">
                        <div class="flex flex-col justify-center items-center text-center py-12"><div class="max-w-3xl"><h1 class="text-4xl md:text-6xl font-extrabold text-white text-shadow-emerald mb-4">আপনার দৈনিক আয় সংগ্রহ করুন</h1><p class="text-slate-300 mt-2 max-w-xl mx-auto text-lg mb-10">আপনার বর্তমান লেভেল অনুযায়ী ইনকাম ক্লেইম করতে নিচের বাটনে ক্লিক করুন।</p><div class="mb-12"><p class="text-slate-400">আপনার আজকের সম্ভাব্য আয়</p><p id="potential-income" class="text-7xl font-bold text-white my-2">৳ 0.00</p><p id="user-level-info" class="text-emerald-400 font-semibold">আপনার বর্তমান লেভেল: 0</p></div><button id="claim-button">ইনকাম ক্লেইম করুন</button><p id="claim-status-text" class="mt-6 text-slate-500"></p></div></div>
                    </div>
                    
                    <!-- Tab: Levels -->
                    <div id="tab-levels" class="dashboard-tab-content">
                        <div class="text-center mb-16"><h1 class="text-4xl md:text-5xl font-extrabold text-white text-shadow-emerald">ইনকাম প্ল্যান ও লেভেলসমূহ</h1><p class="text-slate-300 mt-4 max-w-2xl mx-auto text-lg">আপনার বিনিয়োগ ও আয়ের পরিমাণ অনুযায়ী প্রতিটি লেভেল ডিজাইন করা হয়েছে।</p></div><div id="levels-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"></div>
                    </div>

                    <!-- Tab: Referral -->
                    <div id="tab-referral" class="dashboard-tab-content">
                        <div class="flex justify-center"><div class="w-full max-w-3xl"><div class="glass-card p-8 md:p-12"><div class="text-center mb-8"><h1 class="text-4xl font-bold text-white text-shadow-emerald">রেফার করে আয় করুন</h1><p class="text-slate-400 mt-2">আপনার বন্ধুদের আমন্ত্রণ জানান এবং বোনাস জিতুন।</p></div><div class="mb-8"><h3 class="text-xl font-semibold text-white mb-4">আপনার রেফারেল লিংক</h3><div class="bg-slate-800 border-2 dashed border-slate-600 p-4 rounded-lg flex flex-col sm:flex-row items-center justify-between gap-4"><span id="referralLink" class="text-sm sm:text-base font-mono text-emerald-300 break-all">লিংক তৈরি হচ্ছে...</span><button id="copyReferralButton" class="bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded-md flex-shrink-0">লিংক কপি করুন</button></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center"><div class="bg-slate-800/50 p-6 rounded-lg"><p class="text-slate-400 text-sm font-medium uppercase">মোট রেফারেল</p><p id="referralCount" class="text-3xl font-bold text-white mt-1">0</p></div><div class="bg-slate-800/50 p-6 rounded-lg"><p class="text-slate-400 text-sm font-medium uppercase">রেফারেল থেকে আয়</p><p id="referralEarnings" class="text-3xl font-bold text-white mt-1">৳ 0.00</p></div></div><p class="text-xs text-slate-500 mt-6 text-center">দ্রষ্টব্য: এটি একটি সিমুলেটেড বৈশিষ্ট্য। বাস্তব প্রয়োগের জন্য একটি সার্ভার-সাইড ব্যাকএন্ড প্রয়োজন।</p></div></div></div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ===================================================================== -->
        <!-- NEW: VIEW 3: ADMIN PANEL PAGE                                         -->
        <!-- ===================================================================== -->
        <div id="page-admin" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <h1 class="text-4xl font-bold text-white mb-2">অ্যাডমিন প্যানেল</h1>
                <p class="text-slate-400 mb-8">সাইটের সকল ব্যবহারকারী এবং লেনদেন পরিচালনা করুন।</p>

                <!-- Admin Tabs Navigation -->
                <div class="border-b border-slate-700 mb-8">
                    <nav class="-mb-px flex space-x-2 sm:space-x-6 overflow-x-auto" id="admin-tabs">
                        <button data-tab="admin-overview" class="admin-tab-button active">সারসংক্ষেপ</button>
                        <button data-tab="admin-deposits" class="admin-tab-button">ডিপোজিট</button>
                        <button data-tab="admin-withdrawals" class="admin-tab-button">উইথড্রয়াল</button>
                        <button data-tab="admin-users" class="admin-tab-button">ব্যবহারকারী</button>
                    </nav>
                </div>
                
                <!-- Admin Tab Content -->
                <div id="admin-content">
                    <!-- Tab: Admin Overview -->
                    <div id="tab-admin-overview" class="admin-tab-content active">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
                            <div class="stat-card"><div class="icon-bg">👥</div><p class="text-slate-400 text-sm font-medium uppercase">মোট ব্যবহারকারী</p><p class="text-3xl font-bold text-white mt-1" id="adminTotalUsers">0</p></div>
                            <div class="stat-card"><div class="icon-bg">💰</div><p class="text-slate-400 text-sm font-medium uppercase">মোট ডিপোজিট</p><p class="text-3xl font-bold text-emerald-400 mt-1" id="adminTotalDeposit">৳ 0.00</p></div>
                            <div class="stat-card"><div class="icon-bg">💸</div><p class="text-slate-400 text-sm font-medium uppercase">মোট উইথড্র</p><p class="text-3xl font-bold text-rose-400 mt-1" id="adminTotalWithdraw">৳ 0.00</p></div>
                            <div class="stat-card"><div class="icon-bg">⏳</div><p class="text-slate-400 text-sm font-medium uppercase">পেন্ডিং উইথড্র</p><p class="text-3xl font-bold text-amber-400 mt-1" id="adminPendingWithdraw">0</p></div>
                        </div>
                         <div class="glass-card p-6">
                            <h2 class="text-xl font-bold text-white mb-4">সাম্প্রতিক কার্যক্রম</h2>
                            <div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead class=""><tr><th>ব্যবহারকারী</th><th>অ্যাকশন</th><th>পরিমাণ</th><th>তারিখ</th></tr></thead><tbody id="adminRecentActivity"></tbody></table></div>
                        </div>
                    </div>

                    <!-- Tab: Admin Deposits -->
                    <div id="tab-admin-deposits" class="admin-tab-content">
                        <div class="glass-card p-6">
                            <h2 class="text-xl font-bold text-white mb-4">সকল ডিপোজিট</h2>
                            <div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>ব্যবহারকারী</th><th>মোবাইল</th><th>পরিমাণ</th><th>TrxID</th><th>তারিখ</th></tr></thead><tbody id="adminDepositsTableBody"></tbody></table></div>
                        </div>
                    </div>

                    <!-- Tab: Admin Withdrawals -->
                    <div id="tab-admin-withdrawals" class="admin-tab-content">
                         <div class="glass-card p-6">
                            <h2 class="text-xl font-bold text-white mb-4">সকল উইথড্র রিকোয়েস্ট</h2>
                            <div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>ব্যবহারকারী</th><th>বিকাশ নম্বর</th><th>পরিমাণ</th><th>স্ট্যাটাস</th><th>তারিখ</th><th>অ্যাকশন</th></tr></thead><tbody id="adminWithdrawalsTableBody"></tbody></table></div>
                        </div>
                    </div>

                     <!-- Tab: Admin Users -->
                    <div id="tab-admin-users" class="admin-tab-content">
                        <div class="glass-card p-6">
                            <h2 class="text-xl font-bold text-white mb-4">সকল ব্যবহারকারী</h2>
                            <div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>নাম</th><th>মোবাইল</th><th>ব্যালেন্স</th><th>লেভেল</th><th>যোগদান</th><th>অ্যাকশন</th></tr></thead><tbody id="adminUsersTableBody"></tbody></table></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals (Global) -->
    <div id="loginModal" class="modal-overlay"></div>
    <div id="confirmationModal" class="modal-overlay">
         <div class="modal-content text-center">
            <lottie-player id="lottie-success" src="https://assets1.lottiefiles.com/packages/lf20_vuu2h5j2.json" background="transparent" speed="1" style="width: 150px; height: 150px; margin: 0 auto;"></lottie-player>
            <h2 id="confirmation-title" class="text-2xl font-bold text-white mt-4 mb-2">সফল হয়েছে!</h2>
            <p id="confirmation-message" class="text-slate-400 mb-6">আপনার অনুরোধ গ্রহণ করা হয়েছে।</p>
            <button id="confirmation-close-btn" class="cta-button-animated"><span>বন্ধ করুন</span></button>
        </div>
    </div>
    <div id="levelUpModal" class="modal-overlay">
         <div class="modal-content text-center overflow-hidden">
            <lottie-player src="https://assets2.lottiefiles.com/packages/lf20_p23cs1e5.json" background="transparent" speed="1" style="width: 250px; height: 250px; margin: -50px auto -60px;"></lottie-player>
            <h2 class="text-3xl font-extrabold text-white mt-4 mb-2">অভিনন্দন! লেভেল আপ!</h2>
            <p id="level-up-message" class="text-emerald-300 text-lg mb-6">আপনি একটি নতুন লেভেলে উন্নীত হয়েছেন!</p>
            <button id="level-up-close-btn" class="cta-button-animated"><span>দারুণ!</span></button>
        </div>
    </div>
    <!-- NEW: Admin Edit User Modal -->
    <div id="editUserModal" class="modal-overlay">
         <div class="modal-content">
            <button id="editUser-close-btn" class="modal-close-btn">&times;</button>
            <h2 class="text-2xl font-bold text-white mb-6">ব্যবহারকারীর তথ্য পরিবর্তন করুন</h2>
            <form id="editUserForm" class="space-y-4">
                <input type="hidden" id="editUserMobile">
                <div>
                    <label for="editUserBalance" class="block mb-2 text-sm font-medium text-slate-300">বর্তমান ব্যালেন্স</label>
                    <input type="number" id="editUserBalance" class="form-input" required step="any">
                </div>
                <div>
                    <label for="editUserLevel" class="block mb-2 text-sm font-medium text-slate-300">বর্তমান লেভেল</label>
                    <input type="number" id="editUserLevel" class="form-input" required min="0" max="4">
                </div>
                 <button type="submit" class="w-full cta-button-animated py-3"><span>পরিবর্তন সেভ করুন</span></button>
            </form>
        </div>
    </div>


    <!-- Footer -->
    <footer class="bg-slate-900/80 border-t border-slate-700/50 mt-10">
        <div class="container mx-auto px-6 py-8 text-center text-slate-400">
            <p>&copy; 2023 Taka Money. সর্বস্বত্ব সংরক্ষিত।</p>
            <p class="text-sm mt-2">দয়া করে মনে রাখবেন: এটি একটি ডেমো এবং সিমুলেশন প্রকল্প। এখানে কোনো বাস্তব আর্থিক লেনদেন করা উচিত নয়।</p>
            
            <!-- NEW: Admin Login Link -->
            <p class="mt-4">
                <a href="#admin" class="nav-link text-emerald-400 hover:underline">অ্যাডমিন লগইন</a>
            </p>

        </div>
    </footer>

<script>
// =================================================================================================
// MASTER JAVASCRIPT FOR Taka Money SINGLE PAGE APPLICATION (MODIFIED WITH ADMIN PANEL)
// This script controls routing, state management, and all functionalities for the entire app.
// =================================================================================================
'use strict';
document.addEventListener('DOMContentLoaded', () => {

    // --- SECTION: APPLICATION CONSTANTS & CONFIGURATION ---
    const AUTH_KEY = 'takamoney_auth_user';
    const LOGGED_IN_KEY = 'takamoney_is_logged_in';
    const ALL_USERS_KEY = 'takamoney_all_users_db'; // NEW: For admin panel simulation
    const ADMIN_PASS = 'admin123'; // NEW: Simple password for admin access

    const MIN_WITHDRAW_AMOUNT = 300;
    const MAX_DEPOSIT_AMOUNT = 100;
    
    const LEVELS_DATA = [
        { id: 1, deposit: 30, income: 20, color: 'emerald', borderColor: 'border-emerald-500', bgColor: 'bg-emerald-600', hoverBg: 'hover:bg-emerald-500' },
        { id: 2, deposit: 50, income: 35, color: 'teal', borderColor: 'border-teal-500', bgColor: 'bg-teal-600', hoverBg: 'hover:bg-teal-500' },
        { id: 3, deposit: 80, income: 70, color: 'sky', borderColor: 'border-sky-500', bgColor: 'bg-sky-600', hoverBg: 'hover:bg-sky-500' },
        { id: 4, deposit: 100, income: 90, color: 'rose', borderColor: 'border-rose-500', bgColor: 'bg-rose-600', hoverBg: 'hover:bg-rose-500' },
    ];
    const INCOME_BY_LEVEL = { 0: 0, 1: 20, 2: 35, 3: 70, 4: 90 };
    
    let incomeChartInstance = null; // To hold the chart instance

    // --- SECTION: CORE STATE MANAGEMENT (Data Layer) ---
    // NEW: Functions to manage the simulated central database
    const getAllUsers = () => JSON.parse(localStorage.getItem(ALL_USERS_KEY)) || [];
    const saveAllUsers = (users) => localStorage.setItem(ALL_USERS_KEY, JSON.stringify(users));

    const getUserData = () => {
        try {
            const user = JSON.parse(localStorage.getItem(AUTH_KEY));
            const defaultUser = { username: 'Guest', mobile: '', joinDate: '', balance: 0, level: 0, lastClaimedDate: null, depositHistory: [], withdrawHistory: [], incomeHistory: [], referralData: { count: 0, earnings: 0 } };
            return user ? { ...defaultUser, ...user } : null;
        } catch {
            return null;
        }
    };
    
    // MODIFIED: saveUserData now updates both current user's session and the central DB
    const saveUserData = (userData) => {
        if (!isLoggedIn() || !userData) return;
        localStorage.setItem(AUTH_KEY, JSON.stringify(userData));
        
        // Update the central database
        let allUsers = getAllUsers();
        const userIndex = allUsers.findIndex(u => u.mobile === userData.mobile);
        if (userIndex > -1) {
            allUsers[userIndex] = userData;
            saveAllUsers(allUsers);
        }
        
        window.dispatchEvent(new CustomEvent('userDataChanged', { detail: userData }));
    };

    const isLoggedIn = () => localStorage.getItem(LOGGED_IN_KEY) === 'true';

    const addBalance = (amount) => {
        const user = getUserData();
        if (!user) return;
        user.balance = (user.balance || 0) + amount;
        saveUserData(user);
    };

    const deductBalance = (amount) => {
        const user = getUserData();
        if (!user || user.balance < amount) return false;
        user.balance -= amount;
        saveUserData(user);
        return true;
    };
    
    const addHistory = (type, record) => {
        const user = getUserData();
        if (!user) return;
        const historyKey = `${type}History`;
        if (!user[historyKey]) user[historyKey] = [];
        user[historyKey].unshift(record);
        saveUserData(user);
    };

    // --- SECTION: UI & NOTIFICATION FUNCTIONS ---
    const showNotification = (message, type = 'info') => {
        const container = document.getElementById('notification-container');
        if (!container) return;
        const iconMap = {
            success: `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`,
            error: `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>`,
            info: `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>`
        };
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `${iconMap[type]}<span>${message}</span>`;
        container.appendChild(notification);
        setTimeout(() => notification.classList.add('show'), 20);
        setTimeout(() => {
            notification.classList.remove('show');
            notification.addEventListener('transitionend', () => notification.remove());
        }, 5000);
    };

    const showConfirmationModal = (title, message) => {
        const modal = document.getElementById('confirmationModal');
        document.getElementById('confirmation-title').textContent = title;
        document.getElementById('confirmation-message').textContent = message;
        modal.classList.add('active');
        const lottiePlayer = document.getElementById('lottie-success');
        lottiePlayer.stop(); lottiePlayer.play();
    };
    document.getElementById('confirmation-close-btn').addEventListener('click', () => document.getElementById('confirmationModal').classList.remove('active'));

    const showLevelUpModal = (newLevel) => {
        const modal = document.getElementById('levelUpModal');
        document.getElementById('level-up-message').innerHTML = `আপনি সফলভাবে <strong class="text-white">Level ${newLevel}</strong>-এ উন্নীত হয়েছেন!`;
        modal.classList.add('active');
        modal.querySelector('lottie-player').play();
    };
    document.getElementById('level-up-close-btn').addEventListener('click', () => document.getElementById('levelUpModal').classList.remove('active'));

    const animateValue = (id, start, end, duration, prefix = '', suffix = '') => {
        const obj = document.getElementById(id);
        if (!obj || (start === end && !isNaN(end))) { if(obj) obj.textContent = `${prefix}${typeof end === 'number' ? end.toFixed(2) : end}${suffix}`; return; }
        let startTimestamp = null;
        const step = (timestamp) => {
            if (!startTimestamp) startTimestamp = timestamp;
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const currentValue = progress * (end - start) + start;
            obj.textContent = `${prefix}${currentValue.toFixed(2)}${suffix}`;
            if (progress < 1) window.requestAnimationFrame(step);
        };
        window.requestAnimationFrame(step);
    };

    // --- SECTION: AUTHENTICATION ---
    const showLoginModal = () => {
        const modalContainer = document.getElementById('loginModal');
        modalContainer.innerHTML = `<div class="modal-content text-center"><button id="closeLoginModal" class="modal-close-btn">&times;</button><h2 class="text-3xl font-bold text-white mb-4">স্বাগতম!</h2><p class="text-slate-400 mb-8">লগইন বা রেজিস্টার করতে আপনার তথ্য দিন।</p><form id="loginForm" novalidate class="space-y-4"><input type="text" id="username" class="form-input" placeholder="আপনার নাম" required><input type="tel" id="mobile" class="form-input" placeholder="মোবাইল নাম্বার (e.g., 017...)" required pattern="01[3-9]\\d{8}"><button type="submit" class="w-full cta-button-animated py-3"><span>লগইন করুন</span></button></form></div>`;
        modalContainer.classList.add('active');
        document.getElementById('closeLoginModal').addEventListener('click', () => modalContainer.classList.remove('active'));
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
    };

    // MODIFIED: handleLogin now saves to central DB
    const handleLogin = (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const mobile = document.getElementById('mobile').value.trim();
        if (!username || !mobile.match(/^01[3-9]\d{8}$/)) {
            showNotification('সঠিক নাম ও মোবাইল নাম্বার দিন।', 'error');
            return;
        }

        let allUsers = getAllUsers();
        let userExists = allUsers.find(u => u.mobile === mobile);
        let userData;

        if (userExists) {
            // User exists, log them in
            userData = userExists;
            userData.username = username; // Allow username update on login
        } else {
            // New user, register them
            userData = {
                username, mobile, joinDate: new Date().toISOString(), balance: 0, level: 0,
                lastClaimedDate: null, depositHistory: [], withdrawHistory: [], incomeHistory: [],
                referralData: { count: 0, earnings: 0 }
            };
            allUsers.push(userData);
        }
        
        saveAllUsers(allUsers);
        localStorage.setItem(AUTH_KEY, JSON.stringify(userData));
        localStorage.setItem(LOGGED_IN_KEY, 'true');
        
        document.getElementById('loginModal').classList.remove('active');
        showNotification(`স্বাগতম, ${username}!`, 'success');
        updateAuthUI();
        navigateTo('dashboard');
    };

    const logout = () => {
        const user = getUserData();
        localStorage.removeItem(AUTH_KEY);
        localStorage.removeItem(LOGGED_IN_KEY);
        showNotification(`বিদায়, ${user?.username || 'ব্যবহারকারী'}!`, 'info');
        updateAuthUI();
        navigateTo('index');
    };

    const updateAuthUI = () => {
        const containers = ['auth-container-desktop', 'auth-container-mobile'];
        const loggedIn = isLoggedIn();
        const user = loggedIn ? getUserData() : null;
        containers.forEach(id => {
            const container = document.getElementById(id);
            if (loggedIn && user) {
                container.innerHTML = `<div class="flex items-center gap-2">${id === 'auth-container-desktop' ? `<span class="hidden lg:inline text-slate-300 mr-4">স্বাগতম, ${user.username}</span>` : ''}<a href="#dashboard" class="nav-link cta-button-secondary text-sm px-4 py-2">ড্যাশবোর্ড</a><button class="logout-btn bg-rose-600 hover:bg-rose-700 text-white font-bold py-2 px-4 rounded-lg text-sm">লগ আউট</button></div>`;
            } else {
                container.innerHTML = `<button class="login-btn cta-button-animated text-sm">লগইন / রেজিস্টার</button>`;
            }
        });
        document.querySelectorAll('.login-btn').forEach(btn => btn.addEventListener('click', showLoginModal));
        document.querySelectorAll('.logout-btn').forEach(btn => btn.addEventListener('click', logout));
    };


    // --- SECTION: ROUTING & PAGE NAVIGATION ---
    // MODIFIED: Added routing for Admin panel with password check
    const navigateTo = (pageId, params = {}) => {
        if (pageId.startsWith('#')) pageId = pageId.substring(1);
        
        // NEW: Admin route protection
        if (pageId === 'admin') {
            const pass = prompt('অ্যাডমিন প্যানেলে প্রবেশের জন্য পাসওয়ার্ড দিন:');
            if (pass !== ADMIN_PASS) {
                showNotification('ভুল পাসওয়ার্ড।', 'error');
                navigateTo('index'); // Go back to index if password is wrong
                return;
            }
        } else {
             const protectedPages = ['dashboard'];
            if (protectedPages.includes(pageId) && !isLoggedIn()) {
                showNotification('এই পৃষ্ঠা দেখতে লগইন করুন।', 'error');
                showLoginModal();
                return;
            }
        }

        document.querySelectorAll('.page-view').forEach(page => page.classList.remove('active'));
        const targetPage = document.getElementById(`page-${pageId}`);
        if (targetPage) {
            targetPage.classList.add('active');
            window.location.hash = pageId;
            if (pageId === 'dashboard') initDashboardPage(params.tab);
            if (pageId === 'admin') initAdminPanel(); // NEW: Initialize admin panel
        } else {
            document.getElementById('page-index').classList.add('active');
            window.location.hash = 'index';
        }
        
        document.getElementById('mobile-menu').classList.add('hidden');
        window.scrollTo(0, 0); // Scroll to top on page change
    };

    
    // --- SECTION: PAGE-SPECIFIC INITIALIZATION & LOGIC ---
    function initDashboardPage(initialTab = 'overview') {
        const userData = getUserData();
        if(!userData) return navigateTo('index');
        
        document.getElementById('welcome-message').textContent = `স্বাগতম, ${userData.username}! আপনার আর্থিক অগ্রগতির সংক্ষিপ্ত বিবরণ।`;
        animateValue('currentBalance', 0, userData.balance, 1000, '৳ ');
        document.getElementById('currentLevel').textContent = `Level ${userData.level}`;
        const totalIncome = userData.incomeHistory.reduce((sum, item) => sum + item.amount, 0);
        const totalDeposit = userData.depositHistory.reduce((sum, item) => sum + item.amount, 0);
        animateValue('totalIncome', 0, totalIncome, 1000, '৳ ');
        animateValue('totalDeposit', 0, totalDeposit, 1000, '৳ ');
        
        const allHistory = [
            ...userData.depositHistory.map(i => ({...i, type: 'ডিপোজিট', class: 'text-green-400'})),
            ...userData.withdrawHistory.map(i => ({...i, type: 'উইথড্র', class: 'text-red-400'})),
            ...userData.incomeHistory.map(i => ({...i, type: 'ইনকাম', class: 'text-emerald-400'})),
        ].sort((a,b) => new Date(b.date) - new Date(a.date));

        const historyTbody = document.getElementById('transactionHistoryTableBody');
        historyTbody.innerHTML = allHistory.length === 0 
            ? `<tr><td colspan="3" class="text-center text-slate-500 py-8">কোনো লেনদেন নেই।</td></tr>`
            : allHistory.slice(0, 20).map(item => `
                <tr>
                    <td>${item.type}</td>
                    <td class="font-semibold ${item.class}">${item.type === 'উইথড্র' ? '-' : '+'} ৳${item.amount.toFixed(2)}</td>
                    <td class="text-xs text-slate-500">${new Date(item.date).toLocaleDateString('bn-BD')}</td>
                </tr>
            `).join('');
        
        initIncomeChart(userData.incomeHistory);
        document.getElementById('depositForm').reset();
        document.getElementById('withdrawPageBalance').textContent = `৳ ${userData.balance.toFixed(2)}`;
        document.getElementById('withdrawSubmitBtn').disabled = userData.balance < MIN_WITHDRAW_AMOUNT;
        document.getElementById('withdrawForm').reset();
        
        initLevelsContent(userData.level);
        initIncomeTodayContent(userData);
        initReferralContent(userData);
        
        switchTab(initialTab || 'overview', 'dashboard');
    }

    function initIncomeChart(incomeHistory) {
        const ctx = document.getElementById('incomeChart');
        if (!ctx) return;
        if(incomeChartInstance) incomeChartInstance.destroy();

        const labels = Array.from({length: 7}, (_, i) => {
            const d = new Date(); d.setDate(d.getDate() - i);
            return d.toLocaleDateString('bn-BD', { weekday: 'short' });
        }).reverse();
        
        const data = labels.map(label => {
            const d = new Date();
            const dayIndex = Array.from({length: 7}, (_, i) => {
                const tempDate = new Date(); tempDate.setDate(tempDate.getDate() - i);
                return tempDate.toLocaleDateString('bn-BD', { weekday: 'short' });
            }).reverse().indexOf(label);
            
            d.setDate(d.getDate() - (6 - dayIndex));
            return incomeHistory
                .filter(item => new Date(item.date).toDateString() === d.toDateString())
                .reduce((sum, item) => sum + item.amount, 0);
        });
        
        incomeChartInstance = new Chart(ctx, {
            type: 'bar',
            data: { labels, datasets: [{ label: 'দৈনিক আয় (৳)', data, backgroundColor: 'rgba(16, 185, 129, 0.6)', borderColor: 'rgba(16, 185, 129, 1)', borderWidth: 2, borderRadius: 5 }] },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(100, 116, 139, 0.2)' }, ticks: { color: '#94a3b8' } }, x: { grid: { display: false }, ticks: { color: '#94a3b8' } } } }
        });
    }

    function initLevelsContent(userLevel) {
        const container = document.getElementById('levels-container');
        container.innerHTML = LEVELS_DATA.map(level => {
            const isActive = level.id === userLevel;
            const isUnlocked = level.id <= userLevel;
            return `
                <div class="level-card glass-card p-8 text-center border-t-4 ${level.borderColor} ${isActive ? 'active' : ''}">
                    ${isActive ? `<div class="active-badge"><span>সক্রিয়</span></div>` : ''}
                    <h3 class="text-3xl font-bold text-${level.color}-400 mb-3">Level ${level.id}</h3>
                    <p class="text-5xl font-extrabold text-white mb-2">৳${level.income}<span class="text-xl text-slate-400">/দিন</span></p>
                    <p class="text-slate-400 mb-6">দৈনিক ইনকাম</p>
                    <div class="h-px bg-slate-700 my-6"></div>
                    <div class="text-left space-y-3 mb-8">
                        <div class="flex justify-between items-center"><span class="text-slate-400">প্রয়োজনীয় ডিপোজিট:</span><span class="font-bold text-white text-lg">৳${level.deposit}</span></div>
                        <div class="flex justify-between items-center"><span class="text-slate-400">স্ট্যাটাস:</span>${isUnlocked ? `<span class="font-semibold text-green-400">আনলকড</span>` : `<span class="font-semibold text-slate-500">লকড</span>`}</div>
                    </div>
                    <button class="nav-link cta-button w-full ${level.bgColor} ${level.hoverBg} ${isUnlocked ? 'opacity-50 cursor-not-allowed' : ''}" ${isUnlocked ? 'disabled' : ''} data-tab-link="deposit">${isUnlocked ? 'ইতিমধ্যে আনলকড' : 'আনলক করুন'}</button>
                </div>
            `;
        }).join('');
    }

    function initIncomeTodayContent({ level = 0, lastClaimedDate }) {
        const potentialIncome = INCOME_BY_LEVEL[level] || 0;
        document.getElementById('potential-income').textContent = `৳ ${potentialIncome.toFixed(2)}`;
        document.getElementById('user-level-info').textContent = `আপনার বর্তমান লেভেল: ${level}`;

        const claimButton = document.getElementById('claim-button');
        const claimStatusText = document.getElementById('claim-status-text');
        const hasClaimedToday = lastClaimedDate === new Date().toDateString();

        if (level === 0) {
            claimButton.disabled = true; claimButton.textContent = "কোনো লেভেল সক্রিয় নেই";
            claimStatusText.textContent = "ইনকাম পেতে হলে প্রথমে একটি লেভেল আনলক করুন।";
        } else if (hasClaimedToday) {
            claimButton.disabled = true; claimButton.classList.add('claimed'); claimButton.textContent = "আজকের আয় সংগ্রহীত";
            claimStatusText.textContent = "আগামীকাল আবার চেষ্টা করুন।";
        } else {
            claimButton.disabled = false; claimButton.classList.remove('claimed'); claimButton.textContent = "ইনকাম ক্লেইম করুন";
            claimStatusText.textContent = "বাটনে ক্লিক করে আপনার আজকের আয় সংগ্রহ করুন।";
        }
    }

    function initReferralContent(userData) {
        const referralLinkEl = document.getElementById('referralLink');
        const referralCountEl = document.getElementById('referralCount');
        const referralEarningsEl = document.getElementById('referralEarnings');

        const baseUrl = window.location.origin + window.location.pathname;
        referralLinkEl.textContent = `${baseUrl}?ref=${userData.mobile}`;

        referralCountEl.textContent = userData.referralData.count;
        referralEarningsEl.textContent = `৳ ${userData.referralData.earnings.toFixed(2)}`;
    }

    // --- NEW SECTION: ADMIN PANEL LOGIC ---
    function initAdminPanel(initialTab = 'admin-overview') {
        const allUsers = getAllUsers();

        // Overview Tab
        const totalUsers = allUsers.length;
        const totalDeposit = allUsers.reduce((sum, user) => sum + user.depositHistory.reduce((s, d) => s + d.amount, 0), 0);
        const totalWithdraw = allUsers.reduce((sum, user) => sum + user.withdrawHistory.filter(w => w.status === 'approved').reduce((s, w) => s + w.amount, 0), 0);
        const pendingWithdrawCount = allUsers.reduce((sum, user) => sum + user.withdrawHistory.filter(w => w.status === 'pending').length, 0);

        document.getElementById('adminTotalUsers').textContent = totalUsers;
        document.getElementById('adminTotalDeposit').textContent = `৳ ${totalDeposit.toFixed(2)}`;
        document.getElementById('adminTotalWithdraw').textContent = `৳ ${totalWithdraw.toFixed(2)}`;
        document.getElementById('adminPendingWithdraw').textContent = pendingWithdrawCount;

        // Recent Activity
        const recentActivity = [];
        allUsers.forEach(u => {
            u.depositHistory.forEach(d => recentActivity.push({ user: u.username, action: 'ডিপোজিট', ...d }));
            u.withdrawHistory.forEach(w => recentActivity.push({ user: u.username, action: `উইথড্র (${w.status})`, ...w }));
        });
        recentActivity.sort((a,b) => new Date(b.date) - new Date(a.date));
        const activityTbody = document.getElementById('adminRecentActivity');
        activityTbody.innerHTML = recentActivity.slice(0, 10).map(act => `
            <tr>
                <td>${act.user}</td>
                <td>${act.action}</td>
                <td class="font-semibold ${act.action.includes('ডিপোজিট') ? 'text-green-400' : 'text-red-400'}">৳${act.amount.toFixed(2)}</td>
                <td class="text-xs text-slate-500">${new Date(act.date).toLocaleDateString('bn-BD')}</td>
            </tr>
        `).join('') || `<tr><td colspan="4" class="text-center py-4">কোনো কার্যক্রম নেই</td></tr>`;


        // Deposits Tab
        const allDeposits = allUsers.flatMap(u => u.depositHistory.map(d => ({ ...d, username: u.username, mobile: u.mobile }))).sort((a,b) => new Date(b.date) - new Date(a.date));
        const depositsTbody = document.getElementById('adminDepositsTableBody');
        depositsTbody.innerHTML = allDeposits.map(d => `
            <tr>
                <td>${d.username}</td>
                <td>${d.mobile}</td>
                <td class="font-semibold text-green-400">৳${d.amount.toFixed(2)}</td>
                <td class="font-mono text-xs">${d.trxId}</td>
                <td class="text-xs text-slate-500">${new Date(d.date).toLocaleDateString('bn-BD')}</td>
            </tr>
        `).join('') || `<tr><td colspan="5" class="text-center py-4">কোনো ডিপোজিট নেই</td></tr>`;


        // Withdrawals Tab
        const allWithdrawals = allUsers.flatMap(u => u.withdrawHistory.map(w => ({ ...w, username: u.username, mobile: u.mobile }))).sort((a,b) => new Date(b.date) - new Date(a.date));
        const withdrawalsTbody = document.getElementById('adminWithdrawalsTableBody');
        withdrawalsTbody.innerHTML = allWithdrawals.map(w => {
            const statusMap = {
                pending: `<span class="status-badge status-pending">পেন্ডিং</span>`,
                approved: `<span class="status-badge status-success">অ্যাপ্রুভড</span>`,
                rejected: `<span class="status-badge status-rejected">রিজেক্টেড</span>`
            };
            const actionButtons = w.status === 'pending' ? `
                <div class="flex gap-2">
                    <button class="admin-action-btn bg-emerald-600 hover:bg-emerald-500" onclick="handleWithdrawAction('${w.mobile}', '${w.date}', 'approved')">Approve</button>
                    <button class="admin-action-btn bg-rose-600 hover:bg-rose-500" onclick="handleWithdrawAction('${w.mobile}', '${w.date}', 'rejected')">Reject</button>
                </div>
            ` : 'N/A';
            return `
                <tr>
                    <td>${w.username}</td>
                    <td>${w.bKashNumber}</td>
                    <td class="font-semibold text-red-400">৳${w.amount.toFixed(2)}</td>
                    <td>${statusMap[w.status]}</td>
                    <td class="text-xs text-slate-500">${new Date(w.date).toLocaleDateString('bn-BD')}</td>
                    <td>${actionButtons}</td>
                </tr>`
        }).join('') || `<tr><td colspan="6" class="text-center py-4">কোনো উইথড্র রিকোয়েস্ট নেই</td></tr>`;
        

        // All Users Tab
        const usersTbody = document.getElementById('adminUsersTableBody');
        usersTbody.innerHTML = allUsers.map(u => `
            <tr>
                <td>${u.username}</td>
                <td>${u.mobile}</td>
                <td class="font-semibold">৳${u.balance.toFixed(2)}</td>
                <td>${u.level}</td>
                <td class="text-xs text-slate-500">${new Date(u.joinDate).toLocaleDateString('bn-BD')}</td>
                <td><button class="admin-action-btn bg-sky-600 hover:bg-sky-500" onclick="openEditUserModal('${u.mobile}')">Edit</button></td>
            </tr>
        `).join('') || `<tr><td colspan="6" class="text-center py-4">কোনো ব্যবহারকারী নেই</td></tr>`;

        switchTab(initialTab, 'admin');
    }

    // NEW: Handle withdraw status changes from admin panel
    window.handleWithdrawAction = (mobile, date, newStatus) => {
        let allUsers = getAllUsers();
        const userIndex = allUsers.findIndex(u => u.mobile === mobile);
        if (userIndex === -1) return;

        const withdrawIndex = allUsers[userIndex].withdrawHistory.findIndex(w => w.date === date);
        if (withdrawIndex === -1) return;
        
        // If request is rejected, refund the amount to the user
        if (newStatus === 'rejected' && allUsers[userIndex].withdrawHistory[withdrawIndex].status === 'pending') {
            allUsers[userIndex].balance += allUsers[userIndex].withdrawHistory[withdrawIndex].amount;
        }
        
        allUsers[userIndex].withdrawHistory[withdrawIndex].status = newStatus;

        saveAllUsers(allUsers);

        // Update current user's data if they are the one being modified
        const currentUser = getUserData();
        if(currentUser && currentUser.mobile === mobile) {
            localStorage.setItem(AUTH_KEY, JSON.stringify(allUsers[userIndex]));
        }
        
        showNotification(`উইথড্র রিকোয়েস্ট ${newStatus} হয়েছে।`, 'success');
        initAdminPanel('admin-withdrawals');
    };

    // NEW: Handle opening and populating the edit user modal
    window.openEditUserModal = (mobile) => {
        const allUsers = getAllUsers();
        const user = allUsers.find(u => u.mobile === mobile);
        if (!user) return;

        document.getElementById('editUserMobile').value = user.mobile;
        document.getElementById('editUserBalance').value = user.balance;
        document.getElementById('editUserLevel').value = user.level;
        document.getElementById('editUserModal').classList.add('active');
    };
    
    // NEW: Close edit user modal
    document.getElementById('editUser-close-btn').addEventListener('click', () => {
        document.getElementById('editUserModal').classList.remove('active');
    });

    // NEW: Handle form submission for editing a user
    document.getElementById('editUserForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const mobile = document.getElementById('editUserMobile').value;
        const newBalance = parseFloat(document.getElementById('editUserBalance').value);
        const newLevel = parseInt(document.getElementById('editUserLevel').value, 10);

        let allUsers = getAllUsers();
        const userIndex = allUsers.findIndex(u => u.mobile === mobile);

        if (userIndex > -1) {
            allUsers[userIndex].balance = newBalance;
            allUsers[userIndex].level = newLevel;
            saveAllUsers(allUsers);

            // Update current user's data if they are the one being edited
            const currentUser = getUserData();
            if(currentUser && currentUser.mobile === mobile) {
                localStorage.setItem(AUTH_KEY, JSON.stringify(allUsers[userIndex]));
            }

            showNotification('ব্যবহারকারীর তথ্য সফলভাবে আপডেট হয়েছে।', 'success');
            document.getElementById('editUserModal').classList.remove('active');
            initAdminPanel('admin-users');
        } else {
            showNotification('ব্যবহারকারী খুঁজে পাওয়া যায়নি।', 'error');
        }
    });


    // --- SECTION: EVENT LISTENERS ---
    
    // Global navigation listener
    document.body.addEventListener('click', (e) => {
        const navLink = e.target.closest('.nav-link');
        if (navLink) {
            e.preventDefault();
            const pageId = navLink.getAttribute('href');
            const tabLink = navLink.dataset.tabLink;
            navigateTo(pageId, { tab: tabLink });
        }
    });

    // MODIFIED: Tab switcher for both dashboards
    function switchTab(tabId, panel = 'dashboard') {
        document.querySelectorAll(`#${panel}-tabs .${panel}-tab-button`).forEach(t => t.classList.remove('active'));
        document.querySelectorAll(`.${panel}-tab-content`).forEach(c => c.classList.remove('active'));
        
        const tabButton = document.querySelector(`button[data-tab="${tabId}"]`);
        const tabContent = document.getElementById(`tab-${tabId}`);
        if(tabButton && tabContent){
            tabButton.classList.add('active');
            tabContent.classList.add('active');
        }
    }
    document.getElementById('dashboard-tabs').addEventListener('click', (e) => {
        if(e.target.matches('.dashboard-tab-button')) switchTab(e.target.dataset.tab, 'dashboard');
    });
    // NEW: Listener for admin tabs
    document.getElementById('admin-tabs').addEventListener('click', (e) => {
        if(e.target.matches('.admin-tab-button')) switchTab(e.target.dataset.tab, 'admin');
    });
    
    
    // Deposit Form Logic
    document.getElementById('depositForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const btn = document.getElementById('depositSubmitBtn');
        btn.disabled = true; btn.firstElementChild.textContent = 'প্রসেসিং...';
        const amount = parseFloat(document.getElementById('depositAmount').value);
        const trxId = document.getElementById('trxId').value.trim();

        if (isNaN(amount) || amount <= 0 || amount > MAX_DEPOSIT_AMOUNT || !trxId) {
            showNotification('সঠিক পরিমাণ ও ট্রানজেকশন আইডি দিন।', 'error');
            btn.disabled = false; btn.firstElementChild.textContent = 'ডিপোজিট কনফার্ম করুন';
            return;
        }

        setTimeout(() => {
            const user = getUserData();
            const oldLevel = user.level;
            addHistory('deposit', { amount, trxId, date: new Date().toISOString() });
            addBalance(amount);

            // Re-fetch user data after updates
            const updatedUser = getUserData();
            const totalDeposit = updatedUser.depositHistory.reduce((sum, item) => sum + item.amount, 0);
            let newLevel = 0;
            if (totalDeposit >= 100) newLevel = 4; else if (totalDeposit >= 80) newLevel = 3; else if (totalDeposit >= 50) newLevel = 2; else if (totalDeposit >= 30) newLevel = 1;
            
            if (newLevel > oldLevel) {
                updatedUser.level = newLevel;
                saveUserData(updatedUser);
                showLevelUpModal(newLevel);
            }

            showConfirmationModal('ডিপোজিট সফল!', `আপনার ৳${amount} ডিপোজিট রিকোয়েস্ট গ্রহণ করা হয়েছে।`);
            document.getElementById('depositForm').reset();
            btn.disabled = false; btn.firstElementChild.textContent = 'ডিপোজিট কনফার্ম করুন';
            initDashboardPage('overview');
        }, 1500);
    });

    document.getElementById('copyButton').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('bKashNumberDeposit').textContent).then(() => showNotification('বিকাশ নম্বর কপি করা হয়েছে!', 'success'));
    });
    document.getElementById('copyReferralButton').addEventListener('click', () => {
        navigator.clipboard.writeText(document.getElementById('referralLink').textContent).then(() => showNotification('রেফারেল লিংক কপি করা হয়েছে!', 'success'));
    });
    
    // Withdraw Form Logic
    document.getElementById('withdrawForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const amount = parseFloat(document.getElementById('withdrawAmount').value);
        const bKashNumber = document.getElementById('bKashNumberWithdraw').value.trim();

        if (isNaN(amount) || amount <= 0 || !bKashNumber.match(/^01[3-9]\d{8}$/)) {
            showNotification('সঠিক পরিমাণ ও বিকাশ নাম্বার দিন।', 'error');
            return;
        }
        if (amount < MIN_WITHDRAW_AMOUNT) {
            showNotification(`সর্বনিম্ন উইথড্র পরিমাণ ৳${MIN_WITHDRAW_AMOUNT}।`, 'error');
            return;
        }
        if (!deductBalance(amount)) {
            showNotification('অপর্যাপ্ত ব্যালেন্স।', 'error');
            return;
        }

        addHistory('withdraw', { amount, bKashNumber, status: 'pending', date: new Date().toISOString() });
        showConfirmationModal('রিকোয়েস্ট সফল!', 'আপনার উইথড্র রিকোয়েস্ট গ্রহণ করা হয়েছে। এটি শীঘ্রই প্রসেস করা হবে।');
        document.getElementById('withdrawForm').reset();
        initDashboardPage('withdraw');
    });

    // Income Claim Logic
    document.getElementById('claim-button').addEventListener('click', () => {
        const user = getUserData();
        const today = new Date().toDateString();
        if (user.level === 0 || user.lastClaimedDate === today) return;
        
        const incomeAmount = INCOME_BY_LEVEL[user.level] || 0;
        addBalance(incomeAmount);
        addHistory('income', { amount: incomeAmount, level: user.level, date: new Date().toISOString() });
        
        const updatedUser = getUserData(); // Re-fetch to get latest data
        updatedUser.lastClaimedDate = today;
        saveUserData(updatedUser);
        
        showNotification(`অভিনন্দন! ৳${incomeAmount.toFixed(2)} আপনার ব্যালেন্সে যোগ হয়েছে।`, 'success');
        triggerCoinAnimation();
        initIncomeTodayContent(getUserData());
        initDashboardPage('overview');
    });

    function triggerCoinAnimation() {
        const container = document.getElementById('coin-container');
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const coin = document.createElement('div');
                coin.className = 'coin';
                coin.style.left = `${Math.random() * 100}vw`;
                coin.style.animationDelay = `${Math.random() * 1}s`;
                container.appendChild(coin);
                coin.addEventListener('animationend', () => coin.remove());
            }, Math.random() * 1000);
        }
    }

    // --- SECTION: INITIAL APPLICATION STARTUP ---
    const initApp = () => {
        const handleRoute = () => navigateTo(window.location.hash || '#index');
        window.addEventListener('popstate', handleRoute);
        
        updateAuthUI();
        initScrollReveal();
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });
        
        handleRoute(); // Load initial page
        console.log("Taka Money SPA Initialized Successfully with Admin Panel.");
    };
    
    const initScrollReveal = () => {
        ScrollReveal({ reset: false, distance: '60px', duration: 1000, delay: 200, easing: 'cubic-bezier(0.5, 0, 0, 1)' });
        ScrollReveal().reveal('.hero-content h1, .hero-content p, .hero-content div', { origin: 'bottom', interval: 200 });
        ScrollReveal().reveal('.hero-animation', { origin: 'right' });
    };

    initApp();
});
</script>
</body>
</html>