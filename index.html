<!DOCTYPE html>
<html lang="bn" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taka Money - আপনার ডিজিটাল আয়ের বিশ্বস্ত সঙ্গী</title>
    <meta name="description" content="Taka Money-এর মাধ্যমে নিরাপদে ইনভেস্ট করুন এবং প্রতিদিন আকর্ষণীয় রিটার্ন পান। আধুনিক, নিরাপদ এবং ব্যবহারকারী-বান্ধব প্ল্যাটফর্ম।">
    <meta name="keywords" content="taka money, online income, investment, bKash deposit, daily income, Bangladesh, earn money online, referral income, admin panel">
    
    <!-- External Libraries (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="https://unpkg.com/scrollreveal"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* 
        =====================================================================
        V3: MASTER STYLESHEET FOR Taka Money (WARM COLOR REDESIGN)
        Theme: Yellow, Amber, Orange, Red on a dark background.
        =====================================================================
        */
        
        /* NEW: Color Palette Variables */
        :root {
            --primary-color: #f59e0b;      /* Amber 500 */
            --primary-color-dark: #d97706; /* Amber 600 */
            --primary-glow: rgba(245, 158, 11, 0.5);

            --red-color: #ef4444;          /* Red 500 */
            --red-color-dark: #dc2626;     /* Red 600 */
            --red-glow: rgba(239, 68, 68, 0.5);

            --orange-color: #f97316;       /* Orange 500 */
            --orange-glow: rgba(249, 115, 22, 0.5);
            
            --yellow-color: #facc15;       /* Yellow 400 */
            --yellow-glow: rgba(250, 204, 21, 0.5);

            --background-dark: #020617;
            --slate-900: #0f172a;
            --slate-800: #1e293b;
            --slate-700: #334155;
            --slate-400: #94a3b8;
            --slate-300: #cbd5e1;
            --white-color: #f8fafc;
        }
        
        html { scroll-behavior: smooth; }

        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--background-dark);
            color: var(--slate-300);
            position: relative;
            overflow-x: hidden;
        }

        /* NEW: Animated Gradient Background with Warm Colors */
        .animated-gradient-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #020617, #0f172a, #4a044e, #7e22ce, var(--red-color), var(--orange-color), var(--primary-color));
            background-size: 600% 600%;
            animation: gradientAnimation 25s ease infinite;
        }
        @keyframes gradientAnimation { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        /* NEW: Premium VFX for Text Glow with new colors */
        @keyframes text-glow-primary { 0%, 100% { text-shadow: 0 0 8px var(--primary-glow), 0 0 16px var(--primary-glow); } 50% { text-shadow: 0 0 12px var(--primary-glow), 0 0 24px var(--primary-glow); } }
        .logo-vfx, .text-glow-primary { animation: text-glow-primary 3s ease-in-out infinite; }
        .text-shadow-primary { text-shadow: 0 2px 20px var(--primary-glow); }
        .text-shadow-red { text-shadow: 0 2px 20px var(--red-glow); }
        .text-shadow-orange { text-shadow: 0 2px 20px var(--orange-glow); }
        .text-bright-white { color: var(--white-color); }

        /* Glassmorphism UI Card Style */
        .glass-card {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border-radius: 1rem; border: 1px solid rgba(100, 116, 139, 0.2);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden;
        }
        .glass-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 0 40px var(--primary-glow);
            border-color: var(--primary-color);
        }

        /* All Button Styles with new colors */
        .cta-button, .cta-button-animated, .cta-button-secondary { display: inline-flex; align-items: center; justify-content: center; padding: 0.8rem 1.8rem; font-weight: 700; border-radius: 0.5rem; transition: all 0.3s ease; cursor: pointer; text-shadow: 0 1px 3px rgba(0,0,0,0.4); }
        .cta-button-animated { position: relative; color: var(--white-color); background-color: var(--primary-color-dark); border: none; overflow: hidden; z-index: 1; box-shadow: 0 0 15px 0 rgba(245, 158, 11, 0); transition: all 0.3s ease; }
        .cta-button-animated::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: var(--primary-color); z-index: -1; transform: scaleX(0); transform-origin: left; transition: transform 0.4s ease-in-out; }
        .cta-button-animated:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 0 25px 5px var(--primary-glow); }
        .cta-button-animated:hover:not(:disabled)::before { transform: scaleX(1); }
        .cta-button-secondary { color: var(--white-color); background-color: transparent; border: 2px solid var(--primary-color-dark); }
        .cta-button-secondary:hover { background-color: var(--primary-color-dark); }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: var(--slate-900); }
        ::-webkit-scrollbar-thumb { background: var(--primary-color-dark); border-radius: 10px; border: 2px solid var(--slate-900); }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-color); }

        /* Form Input Styles */
        .form-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px var(--primary-glow); }
        
        /* Modal, Notification, Page View styles remain largely the same, but colors will be affected by variables */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(2, 6, 23, 0.7); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.4s ease, visibility 0.4s ease; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content { position: relative; background: var(--slate-900); padding: 2.5rem; border-radius: 1rem; border: 1px solid var(--slate-700); width: 90%; max-width: 500px; transform: scale(0.9) translateY(20px); transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .modal-overlay.active .modal-content { transform: scale(1) translateY(0); }
        .modal-close-btn { position: absolute; top: 1rem; right: 1rem; background: none; border: none; color: var(--slate-400); font-size: 1.8rem; line-height: 1; cursor: pointer; transition: color 0.3s, transform 0.3s; }
        .modal-close-btn:hover { color: var(--white-color); transform: rotate(90deg); }
        #notification-container { position: fixed; top: 6rem; right: 1.5rem; z-index: 2000; display: flex; flex-direction: column; gap: 0.75rem; }
        .notification { min-width: 320px; padding: 1rem 1.5rem; border-radius: 0.5rem; color: var(--white-color); opacity: 0; transform: translateX(120%); transition: all 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55); box-shadow: 0 5px 20px rgba(0,0,0,0.4); border-left: 5px solid transparent; display: flex; align-items: center; gap: 1rem; }
        .notification.show { opacity: 1; transform: translateX(0); }
        .notification.success { background: linear-gradient(to right, var(--primary-color), var(--primary-color-dark)); border-left-color: var(--primary-color); }
        .notification.error { background: linear-gradient(to right, var(--red-color), var(--red-color-dark)); border-left-color: var(--red-color); }
        .page-view { display: none; animation: pageFadeIn 0.7s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .page-view.active { display: block; }
        @keyframes pageFadeIn { from { opacity: 0; transform: translateY(30px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        /* Dashboard Hub Styles with new colors */
        .hub-card .hub-icon { background-color: rgba(245, 158, 11, 0.1); color: var(--primary-color); transition: all 0.4s ease; }
        .hub-card:hover .hub-icon { background-color: var(--primary-color); color: var(--white-color); transform: scale(1.1) rotate(-10deg); }
        .hub-card .hub-title { font-size: 1.1rem; font-weight: 600; color: var(--white-color); }

        /* Tables & Badges with new colors */
        .dashboard-table thead th { border-bottom: 2px solid var(--slate-700); }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.8rem; font-weight: 600; }
        .status-success { background-color: rgba(74, 222, 128, 0.1); color: #4ade80; } /* Keeping green for approved status */
        .status-pending { background-color: rgba(250, 204, 21, 0.1); color: #facc15; } /* Yellow for pending */
        .status-rejected { background-color: rgba(239, 68, 68, 0.1); color: #f87171; }
        .admin-action-btn { padding: 0.3rem 0.8rem; font-size: 0.8rem; font-weight: 600; border-radius: 0.375rem; transition: background-color 0.2s; }
        
        /* Daily Income Claim "Charging" Animation */
        .progress-ring-container { position: relative; width: 280px; height: 280px; margin: 2rem auto; }
        .progress-ring { transform: rotate(-90deg); }
        .progress-ring__circle { transition: stroke-dashoffset 0.5s ease-out; stroke-linecap: round; }
        .progress-ring-label { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        #claim-button-circle { padding: 1rem; font-size: 1.25rem; font-weight: 700; border-radius: 9999px; color: #fff; background: linear-gradient(45deg, var(--primary-color-dark), var(--primary-color)); border: none; box-shadow: 0 10px 30px var(--primary-glow); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; }
        #claim-button-circle:hover:not(:disabled) { transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 40px rgba(245, 158, 11, 0.6); }
        #claim-button-circle:disabled { background: #334155; cursor: not-allowed; box-shadow: none; transform: none; opacity: 0.7; }

        /* Coin Animation */
        .coin-animation-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 9999; overflow: hidden; }
        .coin { position: absolute; width: 30px; height: 30px; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23f59e0b"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1.5 13.5h3v-1h-3v1zm0-3h3v-1h-3v1zm0-3h3v-1h-3v1z"/></svg>'); background-size: contain; animation: fall 3s linear; opacity: 0; }
        @keyframes fall { 0% { transform: translateY(-100px) rotate(0deg); opacity: 1; } 100% { transform: translateY(100vh) rotate(720deg); opacity: 0; } }

        /* Back button for sub-pages */
        .back-button { display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 2rem; color: var(--slate-400); font-weight: 500; transition: color 0.3s; }
        .back-button:hover { color: var(--white-color); }
    </style>
</head>
<body class="bg-slate-900 text-slate-300">

    <!-- Global Elements -->
    <div class="animated-gradient-background"></div>
    <div id="notification-container"></div>
    <div class="coin-animation-container" id="coin-container"></div>

    <!-- Header -->
    <header class="sticky top-0 left-0 w-full z-50 bg-slate-900/60 backdrop-blur-xl border-b border-slate-700/50 shadow-lg">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
             <!-- Mobile Menu Button on the LEFT -->
            <button id="mobile-menu-button" class="md:hidden text-white p-2 mr-2">
                <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>

            <a href="#index" class="nav-link flex items-center space-x-3">
                <svg class="w-8 h-8 text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v.01M12 6v-1m0-1V4m0 2.01M12 18v-2m0-2v-2m0-2v-2m0-2V8m0 0h.01M12 6h.01M12 4h.01M12 18h.01M12 20h.01M4 12h2m2 0h2m2 0h2m2 0h2m-2-2h2m-4 4h2m-6-2h2m-2-2h2"></path></svg>
                <span class="text-2xl font-bold text-white tracking-wider">Taka<span class="text-amber-400 logo-vfx">Money</span></span>
            </a>
            
            <div id="auth-container-desktop" class="flex items-center"></div>
        </div>
         <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-slate-800/95 absolute top-full left-0 w-full border-t border-slate-700">
            <a href="#dashboard-hub" class="nav-link block py-3 px-6 hover:bg-slate-700 transition-colors">ড্যাশবোর্ড হাব</a>
            <a href="#deposit" class="nav-link block py-3 px-6 hover:bg-slate-700 transition-colors">ডিপোজিট</a>
            <a href="#withdraw" class="nav-link block py-3 px-6 hover:bg-slate-700 transition-colors">উইথড্র</a>
            <a href="#admin" class="nav-link block py-3 px-6 text-amber-400 hover:bg-slate-700 transition-colors">অ্যাডমিন প্যানেল</a>
            <div id="auth-container-mobile" class="p-4 border-t border-slate-700"></div>
        </div>
    </header>

    <!-- App Content: This div will hold all page views -->
    <div id="app-content">

        <!-- VIEW 1: INDEX / LANDING PAGE -->
        <div id="page-index" class="page-view active">
            <main>
                <section class="min-h-screen flex items-center pt-28 pb-16">
                    <div class="container mx-auto px-6 grid md:grid-cols-2 gap-12 items-center">
                        <div class="hero-content text-center md:text-left">
                            <h1 class="text-4xl md:text-6xl font-extrabold text-bright-white leading-tight mb-5">আপনার ইনকাম শুরু হোক <br class="hidden md:block"> <span class="text-amber-400 text-glow-primary">আজ থেকেই!</span></h1>
                            <p class="text-lg md:text-xl text-slate-300 mb-10 max-w-lg mx-auto md:mx-0">Taka Money হলো একটি স্বয়ংক্রিয় ইনকাম প্ল্যাটফর্ম। এখানে আপনার টাকা নিরাপদে বৃদ্ধি পায় এবং আপনি প্রতিদিন নিশ্চিত মুনাফা অর্জন করতে পারেন।</p>
                            <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start">
                                <a href="#deposit" class="nav-link cta-button-animated"><span>ডিপোজিট করুন</span><svg class="h-6 w-6 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg></a>
                                <a href="#dashboard-hub" class="nav-link cta-button-secondary"><span>ড্যাশবোর্ড দেখুন</span></a>
                            </div>
                        </div>
                        <div class="hero-animation"><lottie-player src="https://assets1.lottiefiles.com/packages/lf20_touohxv0.json" background="transparent" speed="1" style="width: 100%; height: auto; max-width: 500px; margin: 0 auto;" loop autoplay></lottie-player></div>
                    </div>
                </section>
            </main>
        </div>

        <!-- VIEW 2: DASHBOARD HUB (Telegram Mini-app style) -->
        <div id="page-dashboard-hub" class="page-view">
            <main class="container mx-auto px-6 py-10">
                <div class="text-center mb-12">
                    <p class="text-slate-400 mb-2" id="welcome-message">আপনার আর্থিক অগ্রগতির সংক্ষিপ্ত বিবরণ।</p>
                    <p class="text-5xl md:text-6xl font-extrabold text-bright-white text-glow-primary" id="hub-currentBalance">৳ 0.00</p>
                    <p class="text-lg text-slate-300">আপনার বর্তমান ব্যালেন্স</p>
                </div>

                <div class="grid grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 max-w-4xl mx-auto">
                    <a href="#deposit" class="nav-link glass-card hub-card"><div class="hub-icon"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg></div><span class="hub-title">ডিপোজিট</span></a>
                    <a href="#withdraw" class="nav-link glass-card hub-card"><div class="hub-icon !text-red-500 !bg-red-500/10"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg></div><span class="hub-title">উইথড্র</span></a>
                    <a href="#income-claim" class="nav-link glass-card hub-card"><div class="hub-icon"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg></div><span class="hub-title">দৈনিক ইনকাম</span></a>
                    <a href="#levels" class="nav-link glass-card hub-card"><div class="hub-icon"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 11l5-5m0 0l5 5m-5-5v12" /></svg></div><span class="hub-title">আমার লেভেল</span></a>
                    <a href="#referral" class="nav-link glass-card hub-card"><div class="hub-icon !text-orange-500 !bg-orange-500/10"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg></div><span class="hub-title">রেফারেল</span></a>
                    <a href="#history" class="nav-link glass-card hub-card"><div class="hub-icon"><svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg></div><span class="hub-title">হিস্টোরি</span></a>
                </div>
            </main>
        </div>

        <!-- VIEW 3: DEPOSIT PAGE -->
        <div id="page-deposit" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <a href="#dashboard-hub" class="nav-link back-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ফিরে যান</a>
                <div class="flex justify-center"><div class="w-full max-w-2xl"><div class="glass-card p-8 md:p-12"><div class="text-center mb-8"><h1 class="text-4xl font-bold text-bright-white text-shadow-primary">নিরাপদ ডিপোজিট</h1><p class="text-slate-400 mt-2">নিচের নির্দেশনা অনুসরণ করে আপনার একাউন্টে টাকা যোগ করুন।</p></div><div class="mb-8"><h3 class="text-xl font-semibold text-bright-white mb-4 flex items-center"><span class="bg-amber-500 text-slate-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">১</span> টাকা পাঠান</h3><p class="text-slate-400 mb-4">নিচের বিকাশ পার্সোনাল নাম্বারে 'সেন্ড মানি' করুন।</p><div class="bg-slate-800 border-2 dashed border-slate-600 p-4 rounded-lg flex items-center justify-between"><span id="bKashNumberDeposit" class="text-2xl font-bold text-bright-white tracking-widest">01741242983</span><button id="copyButton" class="bg-amber-600 hover:bg-amber-500 text-white font-bold py-2 px-4 rounded-md flex items-center gap-2"><span>কপি</span></button></div></div><div><h3 class="text-xl font-semibold text-bright-white mb-4 flex items-center"><span class="bg-amber-500 text-slate-900 rounded-full h-8 w-8 flex items-center justify-center font-bold mr-3">২</span> তথ্য জমা দিন</h3><form id="depositForm" class="space-y-6" novalidate><div><label for="depositAmount" class="block mb-2 text-sm font-medium text-slate-300">ডিপোজিটের পরিমাণ (টাকা)</label><input type="number" id="depositAmount" name="depositAmount" class="form-input" placeholder="যেমন: 100" required min="1" max="100"><p class="text-xs text-slate-500 mt-1">দিনে সর্বোচ্চ ১০০ টাকা পর্যন্ত ডিপোজিট করা যাবে।</p></div><div><label for="trxId" class="block mb-2 text-sm font-medium text-slate-300">ট্রানজ্যাকশন আইডি (TrxID)</label><input type="text" id="trxId" name="trxId" class="form-input" placeholder="যেমন: 9A4B8C1D3E" required><p class="text-xs text-slate-500 mt-1">বিকাশ থেকে পাওয়া ট্রানজ্যাকশন আইডি এখানে দিন।</p></div><button type="submit" id="depositSubmitBtn" class="w-full cta-button-animated py-3 text-lg"><span>ডিপোজিট কনফার্ম করুন</span></button></form></div></div></div></div>
            </main>
        </div>

        <!-- VIEW 4: WITHDRAW PAGE -->
        <div id="page-withdraw" class="page-view">
            <main class="container mx-auto px-6 py-10">
                <a href="#dashboard-hub" class="nav-link back-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ফিরে যান</a>
                <div class="flex justify-center"><div class="w-full max-w-lg"><div class="glass-card p-8 md:p-12"><div class="text-center mb-8"><h1 class="text-4xl font-bold text-bright-white text-shadow-red">টাকা উত্তোলন</h1><p class="text-slate-400 mt-2">আপনার আয়কৃত টাকা সহজেই উত্তোলন করুন।</p></div><div class="bg-gradient-to-r from-slate-800 to-slate-700 p-4 rounded-lg text-center mb-6 border-l-4 border-amber-400"><p class="text-sm uppercase text-slate-400">আপনার বর্তমান ব্যালেন্স</p><p id="withdrawPageBalance" class="text-4xl font-bold text-bright-white mt-1">৳ 0.00</p></div><div class="bg-slate-800/50 p-4 rounded-lg text-center mb-8"><p class="text-amber-300">উইথড্র করার জন্য মিনিমাম <strong class="text-white">৩০০ টাকা</strong> প্রয়োজন।</p></div><form id="withdrawForm" class="space-y-6" novalidate><div><label for="withdrawAmount" class="block mb-2 text-sm font-medium text-slate-300">উইথড্র পরিমাণ</label><input type="number" id="withdrawAmount" name="withdrawAmount" class="form-input" placeholder="টাকার পরিমাণ লিখুন" required></div><div><label for="bKashNumberWithdraw" class="block mb-2 text-sm font-medium text-slate-300">আপনার বিকাশ নাম্বার</label><input type="tel" id="bKashNumberWithdraw" name="bKashNumberWithdraw" class="form-input" placeholder="01..." required pattern="01[3-9]\d{8}"></div><button type="submit" id="withdrawSubmitBtn" class="w-full cta-button-animated !bg-red-600 hover:!bg-red-500 py-3 text-lg flex items-center justify-center gap-2"><span>রিকোয়েস্ট পাঠান</span></button></form></div></div></div>
            </main>
        </div>

        <!-- VIEW 5: INCOME CLAIM PAGE -->
        <div id="page-income-claim" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <a href="#dashboard-hub" class="nav-link back-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ফিরে যান</a>
                <div class="flex flex-col justify-center items-center text-center py-4"><div class="max-w-3xl"><h1 class="text-4xl md:text-5xl font-extrabold text-bright-white text-shadow-primary mb-4">আপনার দৈনিক আয় সংগ্রহ</h1><p class="text-slate-300 mt-2 max-w-xl mx-auto text-lg mb-6">আপনার বর্তমান লেভেল অনুযায়ী ইনকাম ক্লেইম করার জন্য প্রস্তুত হোন।</p><div class="progress-ring-container"><svg class="progress-ring" width="280" height="280"><circle class="progress-ring__circle" stroke-width="12" stroke="rgba(100, 116, 139, 0.3)" fill="transparent" r="134" cx="140" cy="140"/><circle id="progress-circle" class="progress-ring__circle" stroke-width="12" stroke="var(--primary-color)" fill="transparent" r="134" cx="140" cy="140" stroke-dasharray="842" stroke-dashoffset="842"/></svg><div id="progress-label" class="progress-ring-label"></div></div><div class="mt-8"><p class="text-slate-400">আপনার আজকের সম্ভাব্য আয়</p><p id="potential-income" class="text-5xl font-bold text-bright-white my-2">৳ 0.00</p><p id="user-level-info" class="text-amber-400 font-semibold">আপনার বর্তমান লেভেল: 0</p></div></div></div>
             </main>
        </div>
        
        <!-- VIEW 6: LEVELS PAGE -->
        <div id="page-levels" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <a href="#dashboard-hub" class="nav-link back-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ফিরে যান</a>
                <div class="text-center mb-16"><h1 class="text-4xl md:text-5xl font-extrabold text-bright-white text-shadow-primary">ইনকাম প্ল্যান ও লেভেলসমূহ</h1><p class="text-slate-300 mt-4 max-w-2xl mx-auto text-lg">আপনার বিনিয়োগ ও আয়ের পরিমাণ অনুযায়ী প্রতিটি লেভেল ডিজাইন করা হয়েছে।</p></div>
                <div id="levels-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8"></div>
             </main>
        </div>

        <!-- VIEW 7: REFERRAL PAGE -->
        <div id="page-referral" class="page-view">
            <main class="container mx-auto px-6 py-10">
                <a href="#dashboard-hub" class="nav-link back-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ফিরে যান</a>
                <div class="flex justify-center"><div class="w-full max-w-3xl"><div class="glass-card p-8 md:p-12"><div class="text-center mb-8"><h1 class="text-4xl font-bold text-bright-white text-shadow-orange">রেফার করে আয় করুন</h1><p class="text-slate-400 mt-2">আপনার বন্ধুদের আমন্ত্রণ জানান এবং বোনাস জিতুন।</p></div><div class="mb-8"><h3 class="text-xl font-semibold text-bright-white mb-4">আপনার রেফারেল লিংক</h3><div class="bg-slate-800 border-2 dashed border-slate-600 p-4 rounded-lg flex flex-col sm:flex-row items-center justify-between gap-4"><span id="referralLink" class="text-sm sm:text-base font-mono text-orange-300 break-all">লিংক তৈরি হচ্ছে...</span><button id="copyReferralButton" class="!bg-orange-600 hover:!bg-orange-500 cta-button-animated text-white font-bold py-2 px-4 rounded-md flex-shrink-0">লিংক কপি করুন</button></div></div><div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center"><div class="bg-slate-800/50 p-6 rounded-lg"><p class="text-slate-400 text-sm font-medium uppercase">মোট রেফারেল</p><p id="referralCount" class="text-3xl font-bold text-bright-white mt-1">0</p></div><div class="bg-slate-800/50 p-6 rounded-lg"><p class="text-slate-400 text-sm font-medium uppercase">রেফারেল থেকে আয়</p><p id="referralEarnings" class="text-3xl font-bold text-bright-white mt-1">৳ 0.00</p></div></div><p class="text-xs text-slate-500 mt-6 text-center">দ্রষ্টব্য: এটি একটি সিমুলেটেড বৈশিষ্ট্য। বাস্তব প্রয়োগের জন্য একটি সার্ভার-সাইড ব্যাকএন্ড প্রয়োজন।</p></div></div></div>
            </main>
        </div>

        <!-- VIEW 8: HISTORY PAGE -->
        <div id="page-history" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <a href="#dashboard-hub" class="nav-link back-button"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>ফিরে যান</a>
                <h1 class="text-4xl font-bold text-bright-white mb-8 text-center">লেনদেন হিস্টরি</h1>
                 <div class="glass-card p-6 max-w-4xl mx-auto">
                    <div class="overflow-y-auto max-h-96"><table class="dashboard-table min-w-full"><thead><tr><th>বিবরণ</th><th>পরিমাণ</th><th>স্ট্যাটাস/TrxID</th><th>তারিখ</th></tr></thead><tbody id="transactionHistoryTableBody"></tbody></table></div>
                </div>
             </main>
        </div>

        <!-- VIEW 9: ADMIN PANEL PAGE (FULLY FUNCTIONAL) -->
        <div id="page-admin" class="page-view">
             <main class="container mx-auto px-6 py-10">
                <h1 class="text-4xl font-bold text-white mb-2">অ্যাডমিন প্যানেল</h1>
                <p class="text-slate-400 mb-8">সাইটের সকল ব্যবহারকারী এবং লেনদেন পরিচালনা করুন।</p>
                <div class="border-b border-slate-700 mb-8"><nav class="-mb-px flex space-x-2 sm:space-x-6 overflow-x-auto" id="admin-tabs"><button data-tab="admin-overview" class="admin-tab-button active">সারসংক্ষেপ</button><button data-tab="admin-deposits" class="admin-tab-button">ডিপোজিট</button><button data-tab="admin-withdrawals" class="admin-tab-button">উইথড্রয়াল</button><button data-tab="admin-users" class="admin-tab-button">ব্যবহারকারী</button></nav></div>
                <div id="admin-content">
                    <div id="tab-admin-overview" class="admin-tab-content active"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-10"><div class="glass-card p-6"><div class="text-4xl mb-2">👥</div><p class="text-slate-400 text-sm font-medium uppercase">মোট ব্যবহারকারী</p><p class="text-3xl font-bold text-bright-white mt-1" id="adminTotalUsers">0</p></div><div class="glass-card p-6"><div class="text-4xl mb-2">💰</div><p class="text-slate-400 text-sm font-medium uppercase">মোট ডিপোজিট</p><p class="text-3xl font-bold text-amber-400 mt-1" id="adminTotalDeposit">৳ 0.00</p></div><div class="glass-card p-6"><div class="text-4xl mb-2">💸</div><p class="text-slate-400 text-sm font-medium uppercase">মোট উইথড্র</p><p class="text-3xl font-bold text-rose-400 mt-1" id="adminTotalWithdraw">৳ 0.00</p></div><div class="glass-card p-6"><div class="text-4xl mb-2">⏳</div><p class="text-slate-400 text-sm font-medium uppercase">পেন্ডিং উইথড্র</p><p class="text-3xl font-bold text-yellow-400 mt-1" id="adminPendingWithdraw">0</p></div></div><div class="glass-card p-6"><h2 class="text-xl font-bold text-white mb-4">সাম্প্রতিক কার্যক্রম</h2><div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>ব্যবহারকারী</th><th>অ্যাকশন</th><th>পরিমাণ</th><th>তারিখ</th></tr></thead><tbody id="adminRecentActivity"></tbody></table></div></div></div>
                    <div id="tab-admin-deposits" class="admin-tab-content"><div class="glass-card p-6"><h2 class="text-xl font-bold text-white mb-4">সকল ডিপোজিট</h2><div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>ব্যবহারকারী</th><th>মোবাইল</th><th>পরিমাণ</th><th>TrxID</th><th>তারিখ</th></tr></thead><tbody id="adminDepositsTableBody"></tbody></table></div></div></div>
                    <div id="tab-admin-withdrawals" class="admin-tab-content"><div class="glass-card p-6"><h2 class="text-xl font-bold text-white mb-4">সকল উইথড্র রিকোয়েস্ট</h2><div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>ব্যবহারকারী</th><th>বিকাশ নম্বর</th><th>পরিমাণ</th><th>স্ট্যাটাস</th><th>তারিখ</th><th>অ্যাকশন</th></tr></thead><tbody id="adminWithdrawalsTableBody"></tbody></table></div></div></div>
                    <div id="tab-admin-users" class="admin-tab-content"><div class="glass-card p-6"><h2 class="text-xl font-bold text-white mb-4">সকল ব্যবহারকারী</h2><div class="overflow-x-auto"><table class="dashboard-table min-w-full"><thead><tr><th>নাম</th><th>মোবাইল</th><th>ব্যালেন্স</th><th>লেভেল</th><th>যোগদান</th><th>অ্যাকশন</th></tr></thead><tbody id="adminUsersTableBody"></tbody></table></div></div></div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Modals (Global) -->
    <div id="loginModal" class="modal-overlay"></div>
    <div id="confirmationModal" class="modal-overlay"><div class="modal-content text-center"><lottie-player id="lottie-success" src="https://assets1.lottiefiles.com/packages/lf20_vuu2h5j2.json" background="transparent" speed="1" style="width: 150px; height: 150px; margin: 0 auto;"></lottie-player><h2 id="confirmation-title" class="text-2xl font-bold text-white mt-4 mb-2">সফল হয়েছে!</h2><p id="confirmation-message" class="text-slate-400 mb-6">আপনার অনুরোধ গ্রহণ করা হয়েছে।</p><button id="confirmation-close-btn" class="cta-button-animated"><span>বন্ধ করুন</span></button></div></div>
    <div id="levelUpModal" class="modal-overlay"><div class="modal-content text-center overflow-hidden"><lottie-player src="https://assets2.lottiefiles.com/packages/lf20_p23cs1e5.json" background="transparent" speed="1" style="width: 250px; height: 250px; margin: -50px auto -60px;"></lottie-player><h2 class="text-3xl font-extrabold text-white mt-4 mb-2">অভিনন্দন! লেভেল আপ!</h2><p id="level-up-message" class="text-amber-300 text-lg mb-6">আপনি একটি নতুন লেভেলে উন্নীত হয়েছেন!</p><button id="level-up-close-btn" class="cta-button-animated"><span>দারুণ!</span></button></div></div>
    <div id="editUserModal" class="modal-overlay"><div class="modal-content"><button id="editUser-close-btn" class="modal-close-btn">&times;</button><h2 class="text-2xl font-bold text-white mb-6">ব্যবহারকারীর তথ্য পরিবর্তন করুন</h2><form id="editUserForm" class="space-y-4"><input type="hidden" id="editUserMobile"><div><label for="editUserBalance" class="block mb-2 text-sm font-medium text-slate-300">বর্তমান ব্যালেন্স</label><input type="number" id="editUserBalance" class="form-input" required step="any"></div><div><label for="editUserLevel" class="block mb-2 text-sm font-medium text-slate-300">বর্তমান লেভেল</label><input type="number" id="editUserLevel" class="form-input" required min="0" max="4"></div><button type="submit" class="w-full cta-button-animated py-3"><span>পরিবর্তন সেভ করুন</span></button></form></div></div>

    <!-- Footer -->
    <footer class="bg-slate-900/80 border-t border-slate-700/50 mt-10">
        <div class="container mx-auto px-6 py-8 text-center text-slate-400">
            <p>&copy; 2023 Taka Money. সর্বস্বত্ব সংরক্ষিত।</p>
            <p class="text-sm mt-2">দয়া করে মনে রাখবেন: এটি একটি ডেমো এবং সিমুলেশন প্রকল্প। এখানে কোনো বাস্তব আর্থিক লেনদেন করা উচিত নয়।</p>
        </div>
    </footer>

<script>
// =================================================================================================
// V3: MASTER JAVASCRIPT FOR Taka Money (WARM COLOR REDESIGN)
// This script controls routing, state management, and all functionalities for the entire app.
// =================================================================================================
'use strict';
document.addEventListener('DOMContentLoaded', () => {

    // --- SECTION: APPLICATION CONSTANTS & CONFIGURATION ---
    const AUTH_KEY = 'takamoney_auth_user';
    const LOGGED_IN_KEY = 'takamoney_is_logged_in';
    const ALL_USERS_KEY = 'takamoney_all_users_db';
    const ADMIN_PASS = 'admin123';

    const MIN_WITHDRAW_AMOUNT = 300;
    const MAX_DEPOSIT_AMOUNT = 100;
    
    // NEW: Levels Data with Warm Color Palette Progression
    const LEVELS_DATA = [
        { id: 1, deposit: 30, income: 20, color: 'yellow', name: 'Yellow', textColor: 'text-yellow-400', borderColor: 'border-yellow-500' },
        { id: 2, deposit: 50, income: 35, color: 'amber', name: 'Amber', textColor: 'text-amber-400', borderColor: 'border-amber-500' },
        { id: 3, deposit: 80, income: 70, color: 'orange', name: 'Orange', textColor: 'text-orange-400', borderColor: 'border-orange-500' },
        { id: 4, deposit: 100, income: 90, color: 'red', name: 'Red', textColor: 'text-red-400', borderColor: 'border-red-500' },
    ];
    const INCOME_BY_LEVEL = { 0: 0, 1: 20, 2: 35, 3: 70, 4: 90 };
    
    let claimInterval = null;

    // --- SECTION: CORE STATE MANAGEMENT (Data Layer) ---
    const getAllUsers = () => JSON.parse(localStorage.getItem(ALL_USERS_KEY)) || [];
    const saveAllUsers = (users) => localStorage.setItem(ALL_USERS_KEY, JSON.stringify(users));

    const getUserData = () => {
        try {
            const user = JSON.parse(localStorage.getItem(AUTH_KEY));
            const defaultUser = { username: 'Guest', mobile: '', joinDate: '', balance: 0, level: 0, lastClaimedDate: null, depositHistory: [], withdrawHistory: [], incomeHistory: [], referralData: { count: 0, earnings: 0 } };
            return user ? { ...defaultUser, ...user } : null;
        } catch { return null; }
    };
    
    const saveUserData = (userData) => {
        if (!isLoggedIn() || !userData) return;
        localStorage.setItem(AUTH_KEY, JSON.stringify(userData));
        let allUsers = getAllUsers();
        const userIndex = allUsers.findIndex(u => u.mobile === userData.mobile);
        if (userIndex > -1) {
            allUsers[userIndex] = userData;
            saveAllUsers(allUsers);
        }
        window.dispatchEvent(new CustomEvent('userDataChanged', { detail: userData }));
    };

    const isLoggedIn = () => localStorage.getItem(LOGGED_IN_KEY) === 'true';
    const addBalance = (amount) => { const user = getUserData(); if (!user) return; user.balance = (user.balance || 0) + amount; saveUserData(user); };
    const deductBalance = (amount) => { const user = getUserData(); if (!user || user.balance < amount) return false; user.balance -= amount; saveUserData(user); return true; };
    const addHistory = (type, record) => { const user = getUserData(); if (!user) return; const historyKey = `${type}History`; if (!user[historyKey]) user[historyKey] = []; user[historyKey].unshift(record); saveUserData(user); };

    // --- SECTION: UI & NOTIFICATION FUNCTIONS ---
    const showNotification = (message, type = 'info') => {
        const container = document.getElementById('notification-container');
        if (!container) return;
        const iconMap = {
            success: `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>`,
            error: `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>`,
            info: `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>`
        };
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `${iconMap[type]}<span>${message}</span>`;
        container.appendChild(notification);
        setTimeout(() => notification.classList.add('show'), 20);
        setTimeout(() => { notification.classList.remove('show'); notification.addEventListener('transitionend', () => notification.remove()); }, 5000);
    };

    const showConfirmationModal = (title, message) => { const modal = document.getElementById('confirmationModal'); document.getElementById('confirmation-title').textContent = title; document.getElementById('confirmation-message').textContent = message; modal.classList.add('active'); const lottiePlayer = document.getElementById('lottie-success'); lottiePlayer.stop(); lottiePlayer.play(); };
    document.getElementById('confirmation-close-btn').addEventListener('click', () => document.getElementById('confirmationModal').classList.remove('active'));

    const showLevelUpModal = (newLevel) => { const modal = document.getElementById('levelUpModal'); document.getElementById('level-up-message').innerHTML = `আপনি সফলভাবে <strong class="text-white">Level ${newLevel}</strong>-এ উন্নীত হয়েছেন!`; modal.classList.add('active'); modal.querySelector('lottie-player').play(); };
    document.getElementById('level-up-close-btn').addEventListener('click', () => document.getElementById('levelUpModal').classList.remove('active'));
    
    // --- AUTHENTICATION ---
    const showLoginModal = () => {
        const modalContainer = document.getElementById('loginModal');
        modalContainer.innerHTML = `<div class="modal-content text-center"><button id="closeLoginModal" class="modal-close-btn">&times;</button><h2 class="text-3xl font-bold text-white mb-4">স্বাগতম!</h2><p class="text-slate-400 mb-8">লগইন বা রেজিস্টার করতে আপনার তথ্য দিন।</p><form id="loginForm" novalidate class="space-y-4"><input type="text" id="username" class="form-input" placeholder="আপনার নাম" required><input type="tel" id="mobile" class="form-input" placeholder="মোবাইল নাম্বার (e.g., 017...)" required pattern="01[3-9]\\d{8}"><button type="submit" class="w-full cta-button-animated py-3"><span>লগইন করুন</span></button></form></div>`;
        modalContainer.classList.add('active');
        document.getElementById('closeLoginModal').addEventListener('click', () => modalContainer.classList.remove('active'));
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
    };

    const handleLogin = (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        const mobile = document.getElementById('mobile').value.trim();
        if (!username || !mobile.match(/^01[3-9]\d{8}$/)) { showNotification('সঠিক নাম ও মোবাইল নাম্বার দিন।', 'error'); return; }
        let allUsers = getAllUsers();
        let userExists = allUsers.find(u => u.mobile === mobile);
        let userData;
        if (userExists) { userData = userExists; userData.username = username; } else { userData = { username, mobile, joinDate: new Date().toISOString(), balance: 0, level: 0, lastClaimedDate: null, depositHistory: [], withdrawHistory: [], incomeHistory: [], referralData: { count: 0, earnings: 0 } }; allUsers.push(userData); }
        saveAllUsers(allUsers);
        localStorage.setItem(AUTH_KEY, JSON.stringify(userData));
        localStorage.setItem(LOGGED_IN_KEY, 'true');
        document.getElementById('loginModal').classList.remove('active');
        showNotification(`স্বাগতম, ${username}!`, 'success');
        updateAuthUI();
        navigateTo('dashboard-hub');
    };

    const logout = () => { const user = getUserData(); localStorage.removeItem(AUTH_KEY); localStorage.removeItem(LOGGED_IN_KEY); showNotification(`বিদায়, ${user?.username || 'ব্যবহারকারী'}!`, 'info'); updateAuthUI(); navigateTo('index'); };

    const updateAuthUI = () => {
        const desktopContainer = document.getElementById('auth-container-desktop');
        const mobileContainer = document.getElementById('auth-container-mobile');
        const loggedIn = isLoggedIn();
        const user = loggedIn ? getUserData() : null;
        if (loggedIn && user) {
            desktopContainer.innerHTML = `<div class="flex items-center gap-4"><span class="hidden lg:inline text-slate-300">স্বাগতম, ${user.username}</span><button class="logout-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-3 rounded-lg text-sm">লগ আউট</button></div>`;
            mobileContainer.innerHTML = `<div class="text-center"><button class="logout-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg w-full">লগ আউট</button></div>`;
        } else {
            const loginButton = `<button class="login-btn cta-button-animated text-sm">লগইন / রেজিস্টার</button>`;
            desktopContainer.innerHTML = loginButton;
            mobileContainer.innerHTML = `<div class="text-center">${loginButton}</div>`;
        }
        document.querySelectorAll('.login-btn').forEach(btn => btn.addEventListener('click', showLoginModal));
        document.querySelectorAll('.logout-btn').forEach(btn => btn.addEventListener('click', logout));
    };

    // --- ROUTING & PAGE NAVIGATION ---
    const navigateTo = (pageId) => {
        if (pageId.startsWith('#')) pageId = pageId.substring(1);
        if (pageId === 'admin') {
            const pass = prompt('অ্যাডমিন প্যানেলে প্রবেশের জন্য পাসওয়ার্ড দিন:');
            if (pass !== ADMIN_PASS) { showNotification('ভুল পাসওয়ার্ড।', 'error'); navigateTo('index'); return; }
        } else {
             const protectedPages = ['dashboard-hub', 'deposit', 'withdraw', 'income-claim', 'levels', 'referral', 'history'];
            if (protectedPages.includes(pageId) && !isLoggedIn()) { showNotification('এই পৃষ্ঠা দেখতে লগইন করুন।', 'error'); showLoginModal(); return; }
        }
        document.querySelectorAll('.page-view').forEach(page => page.classList.remove('active'));
        const targetPage = document.getElementById(`page-${pageId}`);
        if (targetPage) {
            targetPage.classList.add('active');
            window.location.hash = pageId;
            const initFunctions = { 'dashboard-hub': initDashboardHub, 'deposit': initDepositPage, 'withdraw': initWithdrawPage, 'income-claim': initIncomeClaimPage, 'levels': initLevelsPage, 'referral': initReferralPage, 'history': initHistoryPage, 'admin': initAdminPanel, };
            if(initFunctions[pageId]) initFunctions[pageId]();
        } else {
            document.getElementById('page-index').classList.add('active');
            window.location.hash = 'index';
        }
        document.getElementById('mobile-menu').classList.add('hidden');
        window.scrollTo(0, 0);
    };

    // --- PAGE-SPECIFIC INITIALIZATION ---
    function initPage(initFunction) { const userData = getUserData(); if(!userData) { navigateTo('index'); return null; } initFunction(userData); return userData; }
    function initDashboardHub() { initPage(user => { document.getElementById('welcome-message').textContent = `স্বাগতম, ${user.username}!`; document.getElementById('hub-currentBalance').textContent = `৳ ${user.balance.toFixed(2)}`; }); }
    function initDepositPage() { initPage(user => { document.getElementById('depositForm').reset(); }); }
    function initWithdrawPage() { initPage(user => { document.getElementById('withdrawPageBalance').textContent = `৳ ${user.balance.toFixed(2)}`; document.getElementById('withdrawSubmitBtn').disabled = user.balance < MIN_WITHDRAW_AMOUNT; document.getElementById('withdrawForm').reset(); }); }
    function initLevelsPage() { initPage(user => {
        document.getElementById('levels-container').innerHTML = LEVELS_DATA.map(level => {
            const isActive = level.id === user.level;
            const isUnlocked = level.id <= user.level;
            return `<div class="glass-card p-8 text-center border-t-4 ${level.borderColor} ${isActive ? 'ring-2 ring-current' : ''} relative ${level.textColor}">
                ${isActive ? `<div class="absolute top-2 right-2 bg-current text-slate-900 px-3 py-1 rounded-full text-xs font-bold">সক্রিয়</div>` : ''}
                <h3 class="text-3xl font-bold mb-3">Level ${level.id} (${level.name})</h3>
                <p class="text-5xl font-extrabold text-bright-white mb-2">৳${level.income}<span class="text-xl text-slate-400">/দিন</span></p>
                <p class="text-slate-400 mb-6">দৈনিক ইনকাম</p><div class="h-px bg-slate-700 my-6"></div>
                <div class="text-left space-y-3 mb-8"><div class="flex justify-between items-center"><span class="text-slate-400">প্রয়োজনীয় ডিপোজিট:</span><span class="font-bold text-white text-lg">৳${level.deposit}</span></div><div class="flex justify-between items-center"><span class="text-slate-400">স্ট্যাটাস:</span>${isUnlocked ? `<span class="font-semibold text-green-400">আনলকড</span>` : `<span class="font-semibold text-slate-500">লকড</span>`}</div></div>
                <button class="nav-link cta-button-animated w-full ${isUnlocked ? 'opacity-50 cursor-not-allowed' : ''}" ${isUnlocked ? 'disabled' : ''} onclick="navigateTo('deposit')">${isUnlocked ? 'ইতিমধ্যে আনলকড' : 'আনলক করুন'}</button>
            </div>`;
        }).join('');
    }); }
    function initReferralPage() { initPage(user => { const baseUrl = window.location.origin + window.location.pathname; document.getElementById('referralLink').textContent = `${baseUrl}?ref=${user.mobile}`; document.getElementById('referralCount').textContent = user.referralData.count; document.getElementById('referralEarnings').textContent = `৳ ${user.referralData.earnings.toFixed(2)}`; }); }
    function initHistoryPage() { initPage(user => {
        const allHistory = [
            ...user.depositHistory.map(i => ({...i, type: 'ডিপোজিট', class: 'text-amber-400', detail: i.trxId})),
            ...user.withdrawHistory.map(i => ({...i, type: 'উইথড্র', class: 'text-red-400', detail: i.status})),
            ...user.incomeHistory.map(i => ({...i, type: 'ইনকাম', class: 'text-yellow-400', detail: `লেভেল ${i.level}`})),
        ].sort((a,b) => new Date(b.date) - new Date(a.date));
        document.getElementById('transactionHistoryTableBody').innerHTML = allHistory.length === 0 ? `<tr><td colspan="4" class="text-center text-slate-500 py-8">কোনো লেনদেন নেই।</td></tr>` : allHistory.map(item => `<tr><td>${item.type}</td><td class="font-semibold ${item.class}">${item.type === 'উইথড্র' ? '-' : '+'} ৳${item.amount.toFixed(2)}</td><td class="text-xs font-mono">${item.detail}</td><td class="text-xs text-slate-500">${new Date(item.date).toLocaleString('bn-BD')}</td></tr>`).join('');
    }); }

    function initIncomeClaimPage() {
        const user = getUserData(); if(!user) return navigateTo('index');
        clearInterval(claimInterval);
        const potentialIncome = INCOME_BY_LEVEL[user.level] || 0;
        document.getElementById('potential-income').textContent = `৳ ${potentialIncome.toFixed(2)}`;
        document.getElementById('user-level-info').textContent = `আপনার বর্তমান লেভেল: ${user.level}`;
        const progressCircle = document.getElementById('progress-circle');
        const progressLabel = document.getElementById('progress-label');
        const radius = progressCircle.r.baseVal.value;
        const circumference = 2 * Math.PI * radius;
        progressCircle.style.strokeDasharray = circumference;
        function updateTimer() {
            const now = new Date();
            const lastClaimTime = user.lastClaimedDate ? new Date(user.lastClaimedDate) : new Date(0);
            const timeSinceClaim = now - lastClaimTime;
            const twentyFourHours = 24 * 60 * 60 * 1000;
            const timeRemaining = Math.max(0, twentyFourHours - timeSinceClaim);
            const progress = (twentyFourHours - timeRemaining) / twentyFourHours;
            const offset = circumference - progress * circumference;
            progressCircle.style.strokeDashoffset = offset;
            if (user.level === 0) { progressCircle.style.strokeDashoffset = circumference; progressLabel.innerHTML = `<div class="p-4"><p class="text-lg font-semibold text-slate-400">কোনো লেভেল সক্রিয় নেই</p><p class="text-sm text-slate-500 mt-2">ইনকাম পেতে প্রথমে একটি লেভেল আনলক করুন।</p></div>`; }
            else if (timeRemaining > 0) { const h = Math.floor(timeRemaining / 3600000); const m = Math.floor((timeRemaining % 3600000) / 60000); const s = Math.floor((timeRemaining % 60000) / 1000); progressLabel.innerHTML = `<div class="p-4"><p class="text-slate-400">পরবর্তী ক্লেইম</p><p class="text-4xl font-bold text-bright-white my-2">${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}</p><p class="text-sm text-slate-500">অপেক্ষা করুন...</p></div>`; }
            else { progressCircle.style.strokeDashoffset = 0; progressLabel.innerHTML = `<button id="claim-button-circle">ইনকাম ক্লেইম করুন</button>`; document.getElementById('claim-button-circle').addEventListener('click', handleClaimIncome); clearInterval(claimInterval); }
        }
        updateTimer();
        if (user.level > 0) { claimInterval = setInterval(updateTimer, 1000); }
    }

    // --- ADMIN PANEL LOGIC (FULLY FUNCTIONAL) ---
    function initAdminPanel(initialTab = 'admin-overview') {
        const allUsers = getAllUsers();
        document.getElementById('adminTotalUsers').textContent = allUsers.length;
        document.getElementById('adminTotalDeposit').textContent = `৳ ${allUsers.reduce((sum, user) => sum + user.depositHistory.reduce((s, d) => s + d.amount, 0), 0).toFixed(2)}`;
        document.getElementById('adminTotalWithdraw').textContent = `৳ ${allUsers.reduce((sum, user) => sum + user.withdrawHistory.filter(w => w.status === 'approved').reduce((s, w) => s + w.amount, 0), 0).toFixed(2)}`;
        document.getElementById('adminPendingWithdraw').textContent = allUsers.reduce((sum, user) => sum + user.withdrawHistory.filter(w => w.status === 'pending').length, 0);
        const recentActivity = allUsers.flatMap(u => [...u.depositHistory.map(d => ({ user: u.username, action: 'ডিপোজিট', ...d })), ...u.withdrawHistory.map(w => ({ user: u.username, action: `উইথড্র (${w.status})`, ...w }))]).sort((a, b) => new Date(b.date) - new Date(a.date));
        document.getElementById('adminRecentActivity').innerHTML = recentActivity.slice(0, 10).map(act => `<tr><td>${act.user}</td><td>${act.action}</td><td class="font-semibold ${act.action.includes('ডিপোজিট') ? 'text-amber-400' : 'text-red-400'}">৳${act.amount.toFixed(2)}</td><td class="text-xs text-slate-500">${new Date(act.date).toLocaleDateString('bn-BD')}</td></tr>`).join('') || `<tr><td colspan="4" class="text-center py-4">কোনো কার্যক্রম নেই</td></tr>`;
        const allDeposits = allUsers.flatMap(u => u.depositHistory.map(d => ({ ...d, username: u.username, mobile: u.mobile }))).sort((a,b) => new Date(b.date) - new Date(a.date));
        document.getElementById('adminDepositsTableBody').innerHTML = allDeposits.map(d => `<tr><td>${d.username}</td><td>${d.mobile}</td><td class="font-semibold text-amber-400">৳${d.amount.toFixed(2)}</td><td class="font-mono text-xs">${d.trxId}</td><td class="text-xs text-slate-500">${new Date(d.date).toLocaleDateString('bn-BD')}</td></tr>`).join('') || `<tr><td colspan="5" class="text-center py-4">কোনো ডিপোজিট নেই</td></tr>`;
        const allWithdrawals = allUsers.flatMap(u => u.withdrawHistory.map(w => ({ ...w, username: u.username, mobile: u.mobile }))).sort((a,b) => new Date(b.date) - new Date(a.date));
        document.getElementById('adminWithdrawalsTableBody').innerHTML = allWithdrawals.map(w => {
            const statusMap = { pending: `<span class="status-badge status-pending">পেন্ডিং</span>`, approved: `<span class="status-badge status-success">অ্যাপ্রুভড</span>`, rejected: `<span class="status-badge status-rejected">রিজেক্টেড</span>` };
            const actionButtons = w.status === 'pending' ? `<div class="flex gap-2"><button class="admin-action-btn bg-green-600 hover:bg-green-500" onclick="handleWithdrawAction('${w.mobile}', '${w.date}', 'approved')">Approve</button><button class="admin-action-btn bg-red-600 hover:bg-red-500" onclick="handleWithdrawAction('${w.mobile}', '${w.date}', 'rejected')">Reject</button></div>` : 'N/A';
            return `<tr><td>${w.username}</td><td>${w.bKashNumber}</td><td class="font-semibold text-red-400">৳${w.amount.toFixed(2)}</td><td>${statusMap[w.status]}</td><td class="text-xs text-slate-500">${new Date(w.date).toLocaleDateString('bn-BD')}</td><td>${actionButtons}</td></tr>`
        }).join('') || `<tr><td colspan="6" class="text-center py-4">কোনো উইথড্র রিকোয়েস্ট নেই</td></tr>`;
        document.getElementById('adminUsersTableBody').innerHTML = allUsers.map(u => `<tr><td>${u.username}</td><td>${u.mobile}</td><td class="font-semibold">৳${u.balance.toFixed(2)}</td><td>${u.level}</td><td class="text-xs text-slate-500">${new Date(u.joinDate).toLocaleDateString('bn-BD')}</td><td><button class="admin-action-btn bg-sky-600 hover:bg-sky-500" onclick="openEditUserModal('${u.mobile}')">Edit</button></td></tr>`).join('') || `<tr><td colspan="6" class="text-center py-4">কোনো ব্যবহারকারী নেই</td></tr>`;
        switchAdminTab(initialTab);
    }

    // --- ACTION HANDLERS ---
    document.body.addEventListener('click', (e) => { if (e.target.closest('.nav-link')) { e.preventDefault(); navigateTo(e.target.closest('.nav-link').getAttribute('href')); } });
    function switchAdminTab(tabId) { document.querySelectorAll('#admin-tabs .admin-tab-button').forEach(t => t.classList.remove('active')); document.querySelectorAll(`.admin-tab-content`).forEach(c => c.classList.remove('active')); document.querySelector(`button[data-tab="${tabId}"]`)?.classList.add('active'); document.getElementById(`tab-${tabId}`)?.classList.add('active'); }
    document.getElementById('admin-tabs').addEventListener('click', (e) => { if(e.target.matches('.admin-tab-button')) switchAdminTab(e.target.dataset.tab); });
    
    document.getElementById('depositForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const btn = document.getElementById('depositSubmitBtn'); btn.disabled = true; btn.firstElementChild.textContent = 'প্রসেসিং...';
        const amount = parseFloat(document.getElementById('depositAmount').value);
        const trxId = document.getElementById('trxId').value.trim();
        if (isNaN(amount) || amount <= 0 || amount > MAX_DEPOSIT_AMOUNT || !trxId) { showNotification('সঠিক পরিমাণ ও ট্রানজেকশন আইডি দিন।', 'error'); btn.disabled = false; btn.firstElementChild.textContent = 'ডিপোজিট কনফার্ম করুন'; return; }
        setTimeout(() => {
            const user = getUserData(); const oldLevel = user.level; addHistory('deposit', { amount, trxId, date: new Date().toISOString() }); addBalance(amount);
            const updatedUser = getUserData(); const totalDeposit = updatedUser.depositHistory.reduce((sum, item) => sum + item.amount, 0); let newLevel = 0;
            if (totalDeposit >= 100) newLevel = 4; else if (totalDeposit >= 80) newLevel = 3; else if (totalDeposit >= 50) newLevel = 2; else if (totalDeposit >= 30) newLevel = 1;
            if (newLevel > oldLevel) { updatedUser.level = newLevel; saveUserData(updatedUser); showLevelUpModal(newLevel); }
            showConfirmationModal('ডিপোজিট সফল!', `আপনার ৳${amount} ডিপোজিট রিকোয়েস্ট গ্রহণ করা হয়েছে।`);
            navigateTo('dashboard-hub');
        }, 1500);
    });

    document.getElementById('withdrawForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const amount = parseFloat(document.getElementById('withdrawAmount').value); const bKashNumber = document.getElementById('bKashNumberWithdraw').value.trim();
        if (isNaN(amount) || amount <= 0 || !bKashNumber.match(/^01[3-9]\d{8}$/)) { showNotification('সঠিক পরিমাণ ও বিকাশ নাম্বার দিন।', 'error'); return; }
        if (amount < MIN_WITHDRAW_AMOUNT) { showNotification(`সর্বনিম্ন উইথড্র পরিমাণ ৳${MIN_WITHDRAW_AMOUNT}।`, 'error'); return; }
        if (!deductBalance(amount)) { showNotification('অপর্যাপ্ত ব্যালেন্স।', 'error'); return; }
        addHistory('withdraw', { amount, bKashNumber, status: 'pending', date: new Date().toISOString() });
        showConfirmationModal('রিকোয়েস্ট সফল!', 'আপনার উইথড্র রিকোয়েস্ট গ্রহণ করা হয়েছে। এটি শীঘ্রই প্রসেস করা হবে।');
        navigateTo('history');
    });

    function handleClaimIncome() {
        const user = getUserData(); const incomeAmount = INCOME_BY_LEVEL[user.level] || 0;
        addBalance(incomeAmount); addHistory('income', { amount: incomeAmount, level: user.level, date: new Date().toISOString() });
        const updatedUser = getUserData(); updatedUser.lastClaimedDate = new Date().toISOString(); saveUserData(updatedUser);
        showNotification(`অভিনন্দন! ৳${incomeAmount.toFixed(2)} আপনার ব্যালেন্সে যোগ হয়েছে।`, 'success');
        triggerCoinAnimation(); initIncomeClaimPage();
    };

    function triggerCoinAnimation() { const container = document.getElementById('coin-container'); for (let i = 0; i < 50; i++) { setTimeout(() => { const coin = document.createElement('div'); coin.className = 'coin'; coin.style.left = `${Math.random() * 100}vw`; coin.style.animationDelay = `${Math.random() * 1}s`; container.appendChild(coin); coin.addEventListener('animationend', () => coin.remove()); }, Math.random() * 1000); } }

    window.handleWithdrawAction = (mobile, date, newStatus) => {
        let allUsers = getAllUsers(); const userIndex = allUsers.findIndex(u => u.mobile === mobile); if (userIndex === -1) return;
        const withdrawIndex = allUsers[userIndex].withdrawHistory.findIndex(w => w.date === date); if (withdrawIndex === -1) return;
        if (newStatus === 'rejected' && allUsers[userIndex].withdrawHistory[withdrawIndex].status === 'pending') { allUsers[userIndex].balance += allUsers[userIndex].withdrawHistory[withdrawIndex].amount; }
        allUsers[userIndex].withdrawHistory[withdrawIndex].status = newStatus; saveAllUsers(allUsers);
        if (getUserData()?.mobile === mobile) localStorage.setItem(AUTH_KEY, JSON.stringify(allUsers[userIndex]));
        showNotification(`উইথড্র রিকোয়েস্ট ${newStatus} হয়েছে।`, 'success'); initAdminPanel('admin-withdrawals');
    };

    window.openEditUserModal = (mobile) => { const user = getAllUsers().find(u => u.mobile === mobile); if (!user) return; document.getElementById('editUserMobile').value = user.mobile; document.getElementById('editUserBalance').value = user.balance; document.getElementById('editUserLevel').value = user.level; document.getElementById('editUserModal').classList.add('active'); };
    document.getElementById('editUser-close-btn').addEventListener('click', () => document.getElementById('editUserModal').classList.remove('active'));
    document.getElementById('editUserForm').addEventListener('submit', (e) => { e.preventDefault(); const mobile = document.getElementById('editUserMobile').value; const newBalance = parseFloat(document.getElementById('editUserBalance').value); const newLevel = parseInt(document.getElementById('editUserLevel').value, 10); let allUsers = getAllUsers(); const userIndex = allUsers.findIndex(u => u.mobile === mobile); if (userIndex > -1) { allUsers[userIndex].balance = newBalance; allUsers[userIndex].level = newLevel; saveAllUsers(allUsers); if(getUserData()?.mobile === mobile) localStorage.setItem(AUTH_KEY, JSON.stringify(allUsers[userIndex])); showNotification('ব্যবহারকারীর তথ্য সফলভাবে আপডেট হয়েছে।', 'success'); document.getElementById('editUserModal').classList.remove('active'); initAdminPanel('admin-users'); } });

    // --- INITIAL APPLICATION STARTUP ---
    const initApp = () => {
        const handleRoute = () => navigateTo(window.location.hash || '#index');
        window.addEventListener('popstate', handleRoute);
        updateAuthUI();
        document.getElementById('mobile-menu-button').addEventListener('click', () => { document.getElementById('mobile-menu').classList.toggle('hidden'); });
        document.getElementById('copyButton').addEventListener('click', () => { navigator.clipboard.writeText(document.getElementById('bKashNumberDeposit').textContent).then(() => showNotification('বিকাশ নম্বর কপি করা হয়েছে!', 'success')); });
        document.getElementById('copyReferralButton').addEventListener('click', () => { navigator.clipboard.writeText(document.getElementById('referralLink').textContent).then(() => showNotification('রেফারেল লিংক কপি করা হয়েছে!', 'success')); });
        window.addEventListener('userDataChanged', () => { if (document.getElementById('page-dashboard-hub').classList.contains('active')) { initDashboardHub(); } });
        handleRoute();
        console.log("Taka Money SPA (V3 Warm Color) Initialized Successfully.");
    };

    initApp();
});
</script>
</body>
</html>